<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <base target="_blank"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> [#0001] CSRF in YouTube Leanback API | feed </title> <meta name="description" content=" xdavidhu&#39;s bug bounty disclosures. "> <meta name="keywords" content=""> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="xdavidhu"> <meta name="twitter:title" content="CSRF in YouTube Leanback API"> <meta name="twitter:description" content="xdavidhu's bug bounty disclosures."> <meta name="twitter:image:src" content="http://192.168.56.106:9885/asd/assets/img/cover.png"> <!-- Social: Open Graph --> <meta name="title" property="og:title" content="CSRF in YouTube Leanback API"> <meta name="description" property="og:description" content="xdavidhu's bug bounty disclosures."> <meta name="image" property="og:image" content="http://192.168.56.106:9885/asd/assets/img/cover.png"> <meta name="author" content="David Schütz"> <!-- Canonical link tag --> <link rel="canonical" href="http://192.168.56.106:9885/asd/bugs/0001"> <link rel="alternate" type="application/rss+xml" title="feed" href="http://192.168.56.106:9885/asd/feed.xml"> <!-- rel prev and next --> <link rel="stylesheet" href="http://192.168.56.106:9885/asd/assets/css/main.css"> </head> <body> <main class="wrapper"> <header class="site-header"> <nav> <div class="container nav-container"> <h1 class="logo"><a href="http://192.168.56.106:9885/asd/" target="_self">feed<span></span></a></h1> <ul class="navbar"> <li><a href="https://bugs.xdavidhu.me/" target="_self">bugs.xdavidhu.me</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <p class="post-meta"> <span>#0001</span><br/> <span>Vendor: Google</span><br/> <span>Status: fixed</span><br/> <span>Reported: Jul 24, 2020</span><br/> <span>Disclosed: </span><time datetime="2021-04-05T00:00:00+00:00" itemprop="datePublished">Apr 05, 2021</time> (255 days) </p> <h1 class="post-title" itemprop="name headline">CSRF in YouTube Leanback API</h1> </header> <div class="post-content" itemprop="articleBody"> <p><strong><em>Short Impact:</em></strong></p> <p>All <strong>private/unlisted videos</strong> of a victim can be stolen if the victim visits a malicious link.<br /> Using the same technique, the victim’s <strong>liked videos</strong>, <strong>watch later</strong> and any <strong>private playlist</strong>’s content can be stolen.</p> <p><strong><em>Short Summay:</em></strong></p> <p>Due to the lack of CSRF protection, a malicious website can play any video/playlist on a YouTube TV via the <code class="language-plaintext highlighter-rouge">lounge</code> API in the name of the victim.</p> <p><strong><em>POC Video:</em></strong></p> <p><a href="https://youtu.be/HmdyzRH67ac">https://youtu.be/HmdyzRH67ac</a> - length: 1:46<br /> <em>Source code of the POC shown in the video is attached to this report.</em><br /> <em>Stealing liked videos, watch later and private playlist content is not shown in the POC.</em></p> <p><strong><em>Core Issue:</em></strong></p> <p>There is no CSRF protection on the <code class="language-plaintext highlighter-rouge">https://www.youtube.com/api/lounge/bc/bind</code> endpoint. A malicious website can send a <code class="language-plaintext highlighter-rouge">POST</code> request to this enpoint to request a video/playlist to be played on a YouTube TV. The malicious website can specify which TV to send the video to using the <code class="language-plaintext highlighter-rouge">loungeIdToken</code> parameter.</p> <p><strong><em>POC Flow:</em></strong></p> <p>This sections describes how, using this CSRF, the attacker can steal <em>all</em> of the victim’s private/unlisted videos. More specifically, here I describe how the POC code works.</p> <ol> <li>POC starts a Flask webserver, to serve the victim opening the malicious page. Let’s call the POC python script backend.</li> <li>Victim opens the malicious webpage. Let’s call the victim’s page frontend.</li> <li>Backend requests the attacker to enter the victim’s channel ID.</li> <li>The channel ID’s second character is changed to a <code class="language-plaintext highlighter-rouge">U</code>. The resulting string is the playlist ID of the playlist <code class="language-plaintext highlighter-rouge">Uploads from [Channel Name]</code>, which contains all private/unlisted uploads. Only the owner can see the private/unlisted videos in this playlist. Other users don’t even see the private/unlisted video IDs.</li> <li>The POC sets up a fake TV, and starts to poll the events for the new malicious TV.</li> <li>The frontend is instructed to execute the CSRF request, and play the playlist generated in <code class="language-plaintext highlighter-rouge">Step 4.</code> on the malicious TV.</li> <li>When the CSRF request is sent by the frontend, the backend recieves the TV play event, containing the IDs of all of the victim’s videos, including private/unlisted video IDs.</li> <li>The backend queries the YouTube Data API with all of the video IDs, to find out the which videos are private/unlisted.</li> <li>The unlisted videos are ready, the backend prints the IDs out for the attacker. The unlisted videos only require knowing the video ID to watch.</li> <li>Backend instructs the frontend to play the victim’s private videos on the malicious TV one by one. For every video, the backend sets up a new malicious TV, tells the frontend to play the specific video, listens for play events, and recieves the play event for the TV with a special <code class="language-plaintext highlighter-rouge">ctt</code> parameter. Using the <code class="language-plaintext highlighter-rouge">ctt</code>, the backend queries the <code class="language-plaintext highlighter-rouge">get_video_info</code> YouTube endpoint for the specific private video, authenticates itself with the <code class="language-plaintext highlighter-rouge">ctt</code>, and greps the private video’s title and direct video URl from the response.</li> <li>After every private video is played by the frontend, the backend prints the details of all of the private videos for the attacker.</li> <li>The POC script is done.</li> </ol> <p><em>The specific technical details of how the backend/frontend constructs/sends the requests can be found in the attached POC script.</em></p> <p><em>The <code class="language-plaintext highlighter-rouge">poc.py</code> and the <code class="language-plaintext highlighter-rouge">frontend.html</code> files have to be in the same directory for the script to run.</em></p> <p><strong>Stealing WL/Likes/Private Playlists:</strong></p> <p>Similarly to <code class="language-plaintext highlighter-rouge">Step 6.</code> of the POC, any other private playlists can be played just as the <code class="language-plaintext highlighter-rouge">Uploads from [Channel Name]</code> playlist. And listening for the play event on the backend, the attacker can get the list of video ID’s the given private playlist contains.</p> <p>All channels have a few special private playlists:</p> <ul> <li><code class="language-plaintext highlighter-rouge">WL</code> -&gt; The victim’s <code class="language-plaintext highlighter-rouge">Watch Later</code> playlist</li> <li><code class="language-plaintext highlighter-rouge">LL</code> -&gt; The victim’s <code class="language-plaintext highlighter-rouge">Liked videos</code> playlist</li> </ul> <p>These two can also be stolen using the same method.</p> <p><em><code class="language-plaintext highlighter-rouge">HL</code> used to point to the victim’s <code class="language-plaintext highlighter-rouge">Watch History</code>, but as of my testing, that playlist is not available anymore.</em></p> <p><strong>Aditional Infos:</strong></p> <p>This attack works with not only private, but “draft”, “scheduled” and “removed” videos as well. (These videos are just “private” internally.)</p> <h3 id="extras">Extras:</h3> <p><em>This section was not included in the original report.</em></p> <p>The POC Python script and the frontend JavaScript: <br /> <a href="https://gist.github.com/xdavidhu/b264ee21d8586e580adc7f821ddfbfc9">https://gist.github.com/xdavidhu/b264ee21d8586e580adc7f821ddfbfc9</a></p> <p>Q: <em>Is the <code class="language-plaintext highlighter-rouge">/bind</code> request giving you a <code class="language-plaintext highlighter-rouge">400</code>?</em> <br /> A: That’s “normal”. I stripped off so many parameters that it returns an error, but the video/playlist still gets played on the TV.</p> </div> </article> </main> </body> </html>
