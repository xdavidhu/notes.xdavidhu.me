<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <base target="_blank"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> [#0002] Moving the cursor and acting as other people in Google Docs products | feed </title> <meta name="description" content=" xdavidhu&#39;s bug bounty disclosures. "> <meta name="keywords" content=""> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="xdavidhu"> <meta name="twitter:title" content="Moving the cursor and acting as other people in Google Docs products"> <meta name="twitter:description" content="xdavidhu's bug bounty disclosures."> <meta name="twitter:image:src" content="http://192.168.56.106:9885/asd/assets/img/cover.png"> <!-- Social: Open Graph --> <meta name="title" property="og:title" content="Moving the cursor and acting as other people in Google Docs products"> <meta name="description" property="og:description" content="xdavidhu's bug bounty disclosures."> <meta name="image" property="og:image" content="http://192.168.56.106:9885/asd/assets/img/cover.png"> <meta name="author" content="David Schütz"> <!-- Canonical link tag --> <link rel="canonical" href="http://192.168.56.106:9885/asd/bugs/0002"> <link rel="alternate" type="application/rss+xml" title="feed" href="http://192.168.56.106:9885/asd/feed.xml"> <!-- rel prev and next --> <link rel="stylesheet" href="http://192.168.56.106:9885/asd/assets/css/main.css"> </head> <body> <main class="wrapper"> <header class="site-header"> <nav> <div class="container nav-container"> <h1 class="logo"><a href="http://192.168.56.106:9885/asd/" target="_self">feed<span></span></a></h1> <ul class="navbar"> <li><a href="https://bugs.xdavidhu.me/" target="_self">bugs.xdavidhu.me</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <p class="post-meta"> <span>#0002</span><br/> <span>Vendor: Google</span><br/> <span>Status: <span style='color: red;'>unfixed</span></span><br/> <span>Reported: Jan 20, 2021</span><br/> <span>Disclosed: </span><time datetime="2021-04-20T00:00:00+00:00" itemprop="datePublished">Apr 20, 2021</time> (90 days) </p> <h1 class="post-title" itemprop="name headline">Moving the cursor and acting as other people in Google Docs products</h1> </header> <div class="post-content" itemprop="articleBody"> <p><strong>Short summary:</strong></p> <p>In products that use the same real-time collaboration system as Google Docs, an attacker could take over other user’s “real-time sessions”. This means that the attacker could chat, move the cursor, and perform other collaboration-related actions in the name of any victim.</p> <p><strong>POC Video:</strong></p> <p><a href="https://youtu.be/q34AZ3I4gK8">https://youtu.be/q34AZ3I4gK8</a> - <code class="language-plaintext highlighter-rouge">2:37</code></p> <p><strong>Core Issue:</strong></p> <p>The real-time collaboration system uses a custom 16 char long session ID to authenticate users. When a user opens e.g. a Docs document, the page starts polling the <code class="language-plaintext highlighter-rouge">/bind</code> endpoint, which returns as soon as a new event occurs on the document.</p> <p>The core issue is that the events received by this endpoint <em>almost always</em> contain the session ID of the event initiator. For example, if a new user joins the document, everyone who already has the document open will receive a user object with the new user’s name, profile picture, and among others, <strong>with the new user’s session ID</strong>.</p> <p>The obtained session ID then can be used to perform real-time actions in the name of that user.</p> <p><strong>Steps to reproduce:</strong></p> <p><em>This is a written version of the attack performed in the POC video.</em></p> <ol> <li>Install Burp Suite</li> <li>Create 3 new users, <code class="language-plaintext highlighter-rouge">Attacker</code>, <code class="language-plaintext highlighter-rouge">Victim</code>, and <code class="language-plaintext highlighter-rouge">Observer</code></li> <li>Only start proxying <code class="language-plaintext highlighter-rouge">Attacker</code>’s traffic with Burp</li> <li>With <code class="language-plaintext highlighter-rouge">Victim</code>, Create a new Document, and invite <code class="language-plaintext highlighter-rouge">Attacker</code> and <code class="language-plaintext highlighter-rouge">Observer</code> as <code class="language-plaintext highlighter-rouge">Editor</code>s</li> <li>Open the document in all 3 browser windows</li> <li>Refresh <code class="language-plaintext highlighter-rouge">Victim</code>’s page to generate a new join event on the <code class="language-plaintext highlighter-rouge">/bind</code> endpoint</li> <li>In Burp, look for new <code class="language-plaintext highlighter-rouge">/bind</code> responses, and find the one that includes <code class="language-plaintext highlighter-rouge">Victim</code>’s user object</li> <li>Note the <code class="language-plaintext highlighter-rouge">Victim</code>’s <code class="language-plaintext highlighter-rouge">sid</code> from the user object, and <code class="language-plaintext highlighter-rouge">Attacker</code>’s <code class="language-plaintext highlighter-rouge">sid</code> from the <code class="language-plaintext highlighter-rouge">/bind</code> request’s <code class="language-plaintext highlighter-rouge">sid</code> parameter</li> <li>Go to <code class="language-plaintext highlighter-rouge">Proxy</code> -&gt; <code class="language-plaintext highlighter-rouge">Options</code> -&gt; <code class="language-plaintext highlighter-rouge">Match and Replace</code> and click <code class="language-plaintext highlighter-rouge">Add</code></li> <li>Set the type to <code class="language-plaintext highlighter-rouge">Request first line</code>, set <code class="language-plaintext highlighter-rouge">Match</code> to <code class="language-plaintext highlighter-rouge">Attacker</code>’s <code class="language-plaintext highlighter-rouge">sid</code>, set <code class="language-plaintext highlighter-rouge">Replace</code> to <code class="language-plaintext highlighter-rouge">Victim</code>’s <code class="language-plaintext highlighter-rouge">sid</code>, and click <code class="language-plaintext highlighter-rouge">OK</code></li> <li>With <code class="language-plaintext highlighter-rouge">Attacker</code>, send a new chat message</li> <li>With <code class="language-plaintext highlighter-rouge">Observer</code>, open the chat pane, and see that the message was sent by <code class="language-plaintext highlighter-rouge">Victim</code></li> <li>With <code class="language-plaintext highlighter-rouge">Attacker</code>, start typing and/or selecting text</li> <li>With <code class="language-plaintext highlighter-rouge">Observer</code>, see that it looks like <code class="language-plaintext highlighter-rouge">Victim</code> is selecting/editing the document</li> </ol> <p><strong>Extra Attacks:</strong></p> <ul> <li>Other actions can also be performed when the attacker has the victim’s session ID. For example, using the <code class="language-plaintext highlighter-rouge">/leave</code> endpoint, the victim can be “kicked off” from the document, making her invisible for the other users (but can still edit). Any other endpoint that authenticates with that session ID is probably vulnerable, like <code class="language-plaintext highlighter-rouge">/active</code>.</li> <li>Moving the cursor requires <code class="language-plaintext highlighter-rouge">Editor</code> or <code class="language-plaintext highlighter-rouge">Commenter</code> privileges, so a normal <code class="language-plaintext highlighter-rouge">Viewer</code> can’t move the cursors of <code class="language-plaintext highlighter-rouge">Editor</code>s, since the permission is checked on a Google session level. But, endpoints like <code class="language-plaintext highlighter-rouge">/chat</code> and <code class="language-plaintext highlighter-rouge">/leave</code> can be used by <code class="language-plaintext highlighter-rouge">Viewer</code>s as well. <strong>I was able to chat in the name of any editor with an anonymous (not logged in) account when the document was link-shared with the <code class="language-plaintext highlighter-rouge">Viewer</code> permissions.</strong> That is interesting, since by design only <code class="language-plaintext highlighter-rouge">Editor</code>s and <code class="language-plaintext highlighter-rouge">Commenter</code>s should be able to chat, other roles can’t even see the chat pane.</li> <li>Changing the <code class="language-plaintext highlighter-rouge">sid</code> (from <code class="language-plaintext highlighter-rouge">Attacker</code>’s to <code class="language-plaintext highlighter-rouge">Victim</code>’s) in the <code class="language-plaintext highlighter-rouge">bundles</code> object when making an edit with <code class="language-plaintext highlighter-rouge">Attacker</code> will crash <code class="language-plaintext highlighter-rouge">Victim</code>’s page, with the message <code class="language-plaintext highlighter-rouge">Unable to load file - Try to load it again or send an error report.</code>. Other <code class="language-plaintext highlighter-rouge">Viewer</code>s will not crash, and <strong>if they have the <code class="language-plaintext highlighter-rouge">Live edits</code> accessibility pane enabled, they will see that the edit was made by <code class="language-plaintext highlighter-rouge">Victim</code></strong>. The edit initiator (<code class="language-plaintext highlighter-rouge">Attacker</code>) will be correctly shown in the <code class="language-plaintext highlighter-rouge">Version history</code>.</li> </ul> <p><strong>Limitations:</strong></p> <ul> <li>Changing the <code class="language-plaintext highlighter-rouge">sid</code> in the <code class="language-plaintext highlighter-rouge">Request first line</code> only changes the user of the <code class="language-plaintext highlighter-rouge">selection</code> commands. So, it looks like <code class="language-plaintext highlighter-rouge">Attacker</code> is typing in the name of <code class="language-plaintext highlighter-rouge">Victim</code>, but actually, <code class="language-plaintext highlighter-rouge">Attacker</code> is <strong>only moving the cursor</strong> in the name of <code class="language-plaintext highlighter-rouge">Victim</code>, and editing using her own account. So, checking <code class="language-plaintext highlighter-rouge">Version history</code> will correctly show that the edits were made by <code class="language-plaintext highlighter-rouge">Attacker</code>.</li> <li>In my research, I wasn’t able to trick the <code class="language-plaintext highlighter-rouge">Version history</code> using these session IDs, as it is most likely checking the user’s full Google session.</li> </ul> <p><strong>[Disclosure Warning]:</strong></p> <p><em>This is a new system I am experimenting with:</em></p> <p><strong>This issue is subject to a 90 day disclosure deadline.</strong> On <code class="language-plaintext highlighter-rouge">2021-04-20</code> this issue with all additional comments will be publicly disclosed. Sensitive details from the report/comments such as names/email addresses will be redacted. If you would like to redact additional information or if for some reason the issue can’t be fixed until the deadline, let me know in a comment.</p> <p>Thank you!</p> </div> </article> </main> </body> </html>
