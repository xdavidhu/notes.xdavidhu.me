<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <base target="_blank"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> [#0003] De-anonymising Anonymous Animals in Google Docs products | feed </title> <meta name="description" content=" xdavidhu&#39;s bug bounty disclosures. "> <meta name="keywords" content=""> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="xdavidhu"> <meta name="twitter:title" content="De-anonymising Anonymous Animals in Google Docs products"> <meta name="twitter:description" content="xdavidhu's bug bounty disclosures."> <meta name="twitter:image:src" content="http://192.168.56.106:9885/asd/assets/img/cover.png"> <!-- Social: Open Graph --> <meta name="title" property="og:title" content="De-anonymising Anonymous Animals in Google Docs products"> <meta name="description" property="og:description" content="xdavidhu's bug bounty disclosures."> <meta name="image" property="og:image" content="http://192.168.56.106:9885/asd/assets/img/cover.png"> <meta name="author" content="David Schütz"> <!-- Canonical link tag --> <link rel="canonical" href="http://192.168.56.106:9885/asd/bugs/0003"> <link rel="alternate" type="application/rss+xml" title="feed" href="http://192.168.56.106:9885/asd/feed.xml"> <!-- rel prev and next --> <link rel="stylesheet" href="http://192.168.56.106:9885/asd/assets/css/main.css"> </head> <body> <main class="wrapper"> <header class="site-header"> <nav> <div class="container nav-container"> <h1 class="logo"><a href="http://192.168.56.106:9885/asd/" target="_self">feed<span></span></a></h1> <ul class="navbar"> <li><a href="https://bugs.xdavidhu.me/" target="_self">bugs.xdavidhu.me</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <p class="post-meta"> <span>#0003</span><br/> <span>Vendor: Google</span><br/> <span>Status: fixed</span><br/> <span>Reported: Jan 29, 2021</span><br/> <span>Disclosed: </span><time datetime="2021-04-29T00:00:00+00:00" itemprop="datePublished">Apr 29, 2021</time> (90 days) </p> <h1 class="post-title" itemprop="name headline">De-anonymising Anonymous Animals in Google Docs products</h1> </header> <div class="post-content" itemprop="articleBody"> <p><strong>Summary:</strong></p> <p>In products that use the same real-time collaboration system as Google Docs, “Anonymous Animals” can leak the underlying user’s identity by exposing the real <code class="language-plaintext highlighter-rouge">userId</code> of the victim. If the attacker already knows the <code class="language-plaintext highlighter-rouge">userId</code> of a given victim, she can de-anonymise the victim when the victim is an “Anonymous Animal”.</p> <p><strong>Core Issue:</strong></p> <p>Every active Google Docs user is polling the <code class="language-plaintext highlighter-rouge">/bind</code> endpoint for new real-time events. If a new user opens the document, every already connected user will receive a “connection event” from the <code class="language-plaintext highlighter-rouge">/bind</code> endpoint with the new user’s user object which includes the new user’s name, profile picture, and among others, the <code class="language-plaintext highlighter-rouge">userId</code>.</p> <p>This <code class="language-plaintext highlighter-rouge">userId</code> is unique for only one product. So for example Docs, Sheets and Slides use different <code class="language-plaintext highlighter-rouge">userId</code>s for the same underlying Google user.</p> <p>The core issue is that when a user is an “Anonymous Animal”, her <code class="language-plaintext highlighter-rouge">userId</code> should also be anonymous, and not the same as her real identity’s <code class="language-plaintext highlighter-rouge">userId</code>. Currently a user’s real <code class="language-plaintext highlighter-rouge">userId</code> and “Anonymous Animal” <code class="language-plaintext highlighter-rouge">userId</code> is the same, allowing an attacker to de-anonymise a victim.</p> <p><strong>Steps to reproduce:</strong></p> <ol> <li>Create 2 Google accounts: <code class="language-plaintext highlighter-rouge">Attacker</code> and <code class="language-plaintext highlighter-rouge">Victim</code></li> <li>[<code class="language-plaintext highlighter-rouge">Attacker</code>] Create a new Google Docs document and invite <code class="language-plaintext highlighter-rouge">Victim</code> using her email address, as a viewer</li> <li>[<code class="language-plaintext highlighter-rouge">Attacker</code>] Start monitoring the <code class="language-plaintext highlighter-rouge">/bind</code> responses</li> <li>[<code class="language-plaintext highlighter-rouge">Victim</code>] Open the Google Docs created in <code class="language-plaintext highlighter-rouge">Step 2.</code></li> <li>[<code class="language-plaintext highlighter-rouge">Attacker</code>] See the victim’s user object in the <code class="language-plaintext highlighter-rouge">/bind</code> responses, and note the victim’s <code class="language-plaintext highlighter-rouge">userId</code></li> <li>[<code class="language-plaintext highlighter-rouge">Attacker</code>] Create a new Google Docs document and share it to <code class="language-plaintext highlighter-rouge">anyone with the link</code> -&gt; <code class="language-plaintext highlighter-rouge">Viewer</code></li> <li>[<code class="language-plaintext highlighter-rouge">Attacker</code>] Start monitoring the <code class="language-plaintext highlighter-rouge">/bind</code> responses</li> <li>[<code class="language-plaintext highlighter-rouge">Victim</code>] Open the Google Docs created in <code class="language-plaintext highlighter-rouge">Step 6.</code></li> <li>[<code class="language-plaintext highlighter-rouge">Attacker</code>] See the Anonymous Animal’s user object in the <code class="language-plaintext highlighter-rouge">/bind</code> responses, and see that this <code class="language-plaintext highlighter-rouge">userId</code> is the same <code class="language-plaintext highlighter-rouge">userId</code> previously noted in <code class="language-plaintext highlighter-rouge">Step 5.</code></li> </ol> <p><strong>Impact:</strong></p> <p>This issue <strong>could be used to de-anonymise victims just by making them visit a malicious link/website</strong> which could redirect to/embed an attacker controlled e.g. Google Docs, which when opened by the victim, leaks the victim’s <code class="language-plaintext highlighter-rouge">userId</code> to the attacker.</p> <p>This requires a targeted attack, since an attacker needs to have pre-collected mapping data between <code class="language-plaintext highlighter-rouge">userId</code>s and Google accounts.</p> <p>I wanted to find a way to increase the impact and convert a <code class="language-plaintext highlighter-rouge">userId</code> to a name/email, but I didn’t have any success. If it’s somehow possible to convert a <code class="language-plaintext highlighter-rouge">userId</code> to a name/email, it would allow mass de-anonymisation of every Google user who visits a malicious link.</p> <p><strong>[Disclosure Warning]:</strong></p> <p><em>This is a new system I am experimenting with:</em></p> <p><strong>This issue is subject to a 90 day disclosure deadline.</strong> On <code class="language-plaintext highlighter-rouge">2021-04-29</code> this report with all additional comments will be publicly disclosed. Sensitive details from the report/comments such as names/email addresses will be redacted. If you would like to redact additional information or if for some reason the issue can’t be fixed until the deadline, let me know in a comment.</p> <p>Thank you!</p> </div> </article> </main> </body> </html>
