<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <base target="_blank"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> [#0005] Clickjacking in Google Fast Pair Vendor Dashboard | feed </title> <meta name="description" content=" xdavidhu&#39;s bug bounty disclosures. "> <meta name="keywords" content=""> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="xdavidhu"> <meta name="twitter:title" content="Clickjacking in Google Fast Pair Vendor Dashboard"> <meta name="twitter:description" content="xdavidhu's bug bounty disclosures."> <meta name="twitter:image:src" content="http://192.168.56.106:9885/asd/assets/img/cover.png"> <!-- Social: Open Graph --> <meta name="title" property="og:title" content="Clickjacking in Google Fast Pair Vendor Dashboard"> <meta name="description" property="og:description" content="xdavidhu's bug bounty disclosures."> <meta name="image" property="og:image" content="http://192.168.56.106:9885/asd/assets/img/cover.png"> <meta name="author" content="David Schütz"> <!-- Canonical link tag --> <link rel="canonical" href="http://192.168.56.106:9885/asd/bugs/0005"> <link rel="alternate" type="application/rss+xml" title="feed" href="http://192.168.56.106:9885/asd/feed.xml"> <!-- rel prev and next --> <link rel="stylesheet" href="http://192.168.56.106:9885/asd/assets/css/main.css"> </head> <body> <main class="wrapper"> <header class="site-header"> <nav> <div class="container nav-container"> <h1 class="logo"><a href="http://192.168.56.106:9885/asd/" target="_self">feed<span></span></a></h1> <ul class="navbar"> <li><a href="https://bugs.xdavidhu.me/" target="_self">bugs.xdavidhu.me</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <p class="post-meta"> <span>#0005</span><br/> <span>Vendor: Google</span><br/> <span>Status: fixed</span><br/> <span>Reported: Feb 16, 2021</span><br/> <span>Disclosed: </span><time datetime="2021-05-17T00:00:00+00:00" itemprop="datePublished">May 17, 2021</time> (90 days) </p> <h1 class="post-title" itemprop="name headline">Clickjacking in Google Fast Pair Vendor Dashboard</h1> </header> <div class="post-content" itemprop="articleBody"> <p><strong>Summary:</strong></p> <p>Clickjacking is possible on the Nearby Devices Dashboard. Using this, (among other things) an attacker could create a malicious webpage which can trick a victim into deleting his/her own device.</p> <p><strong>POC Video:</strong></p> <p><a href="https://youtu.be/kqfsgEJjgEM">https://youtu.be/kqfsgEJjgEM</a> (<code class="language-plaintext highlighter-rouge">00:15</code>) (<code class="language-plaintext highlighter-rouge">music</code>)</p> <p><strong>Core Issue:</strong></p> <p>The Nearby Devices Dashboard page on <code class="language-plaintext highlighter-rouge">https://developers.google.com/nearby/devices/</code> actually embeds <code class="language-plaintext highlighter-rouge">https://developers-dot-devsite-v2-prod.appspot.com/nearby/devices/index_c4c5649698417947f28fa2ba0f3267ae10a9a13b3b687a720a65984cfff9e812.frame</code>, which displays the Dashboard. This host behaves just like <code class="language-plaintext highlighter-rouge">developers.google.com</code>, but looks like an AppEngine App.</p> <p>The host <code class="language-plaintext highlighter-rouge">developers-dot-devsite-v2-prod.appspot.com</code> doesn’t have any framing protections.</p> <p>When a victim uses the Nearby Devices Dashboard, she has to log in. When she logs in, since the whole Dashboard is in an iframe, the login cookies get set on <code class="language-plaintext highlighter-rouge">developers-dot-devsite-v2-prod.appspot.com</code>.</p> <p>So, its possible to embed <code class="language-plaintext highlighter-rouge">developers-dot-devsite-v2-prod.appspot.com</code>, and a victim will have valid cookies, so the embedded frame will be logged in.</p> <p><strong>Steps to reproduce:</strong></p> <ol> <li>Create/log into a Google account</li> <li>Go to <code class="language-plaintext highlighter-rouge">https://developers.google.com/nearby/devices/</code>, log in, and create a GCP project when prompted</li> <li>Go to <code class="language-plaintext highlighter-rouge">Add Device</code>, and create a new device. (Choose <code class="language-plaintext highlighter-rouge">Fast Pair</code> -&gt; <code class="language-plaintext highlighter-rouge">Headphones</code> for the least required fields &amp; You must upload an 512x512 image)</li> <li>Convert the new device’s <code class="language-plaintext highlighter-rouge">Model ID</code> from hex to decimal (e.g. for the Pixel Buds: <code class="language-plaintext highlighter-rouge">0x92BBBD</code> -&gt; <code class="language-plaintext highlighter-rouge">9616317</code>)</li> <li>Open the POC HTML file from below, and add the ID after the <code class="language-plaintext highlighter-rouge">#</code> sign in the URL (e.g. <code class="language-plaintext highlighter-rouge">poc.html#9616317</code>)</li> <li>When the POC loads, see that the device management page got embedded, and clicking the <code class="language-plaintext highlighter-rouge">Click here for cat pics!!</code> deletes the victim’s device</li> </ol> <p><strong>POC Code:</strong></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;html&gt;
    &lt;body&gt;
        &lt;button id="button" style="pointer-events: none;z-index:1;left:460px;position:relative;top:-330px;background-color: greenyellow;"&gt;&lt;b&gt;Click here for&lt;br/&gt;cat pics!!&lt;/b&gt;&lt;/button&gt;
        &lt;iframe id="iframe" width=500px height=500px style="opacity: 0.1;"&gt;&lt;/iframe&gt;
    &lt;/body&gt;
    &lt;script&gt;
        document.getElementById("iframe").src = "https://developers-dot-devsite-v2-prod.appspot.com/nearby/devices/index_c4c5649698417947f28fa2ba0f3267ae10a9a13b3b687a720a65984cfff9e812.frame#/devices/view/" + window.location.hash.substring(1);

        window.addEventListener("blur", function(){
            var elem = document.createElement('iframe');
            elem.style.cssText = 'position:absolute;width:50%;height:50%;z-index:100';
            elem.src = "https://www.youtube.com/embed/5wOXc03RwVA?autoplay=1"
            document.body.appendChild(elem);
        });
    &lt;/script&gt;
&lt;/html&gt;
</code></pre></div></div> <p><strong>Real-world Attack:</strong></p> <p><em>Attacker wants to delete the second generation Pixel Buds device, to cause a DOS for users who want to pair with it.</em></p> <ol> <li>Attacker buys a Pixel Buds</li> <li><a href="https://developers.google.com/nearby/fast-pair/spec#advertising_payload_fast_pair_model_id_data">From the BLE advertisements</a>, Attacker notes that the Pixel Buds has a <code class="language-plaintext highlighter-rouge">Model ID</code> of <code class="language-plaintext highlighter-rouge">0x92BBBD</code></li> <li>Attacker converts this ID to decimal <code class="language-plaintext highlighter-rouge">0x92BBBD</code> -&gt; <code class="language-plaintext highlighter-rouge">9616317</code></li> <li>Attacker sets up the POC, and sends the malicious link (<code class="language-plaintext highlighter-rouge">poc.html#9616317</code>) to a Google Engineer who is logged into the Nearby Devices Dashboard and has access to the Pixel Buds device</li> <li>If the Google Engineer clicks <code class="language-plaintext highlighter-rouge">Click here for cat pics!!</code>, the Pixel Buds device gets deleted, probably causing a DOS/other issues for users who want to pair with their Pixel Buds</li> </ol> <p><strong>[Disclosure Warning]:</strong></p> <p><strong>This issue is subject to a 90 day disclosure deadline.</strong> On <code class="language-plaintext highlighter-rouge">2021-05-17</code> this issue will be publicly disclosed. If you would like to redact additional information or if for some reason the issue can’t be fixed until the deadline, let me know in a comment.</p> <p>Thank you!</p> </div> </article> </main> </body> </html>
