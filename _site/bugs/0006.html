<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <base target="_blank"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> [#0006] Path Traversal in MobileSafari | feed </title> <meta name="description" content=" xdavidhu&#39;s bug bounty disclosures. "> <meta name="keywords" content=""> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="xdavidhu"> <meta name="twitter:title" content="Path Traversal in MobileSafari"> <meta name="twitter:description" content="xdavidhu's bug bounty disclosures."> <meta name="twitter:image:src" content="http://192.168.56.106:9885/asd/assets/img/cover.png"> <!-- Social: Open Graph --> <meta name="title" property="og:title" content="Path Traversal in MobileSafari"> <meta name="description" property="og:description" content="xdavidhu's bug bounty disclosures."> <meta name="image" property="og:image" content="http://192.168.56.106:9885/asd/assets/img/cover.png"> <meta name="author" content="David Schütz"> <!-- Canonical link tag --> <link rel="canonical" href="http://192.168.56.106:9885/asd/bugs/0006"> <link rel="alternate" type="application/rss+xml" title="feed" href="http://192.168.56.106:9885/asd/feed.xml"> <!-- rel prev and next --> <link rel="stylesheet" href="http://192.168.56.106:9885/asd/assets/css/main.css"> </head> <body> <main class="wrapper"> <header class="site-header"> <nav> <div class="container nav-container"> <h1 class="logo"><a href="http://192.168.56.106:9885/asd/" target="_self">feed<span></span></a></h1> <ul class="navbar"> <li><a href="https://bugs.xdavidhu.me/" target="_self">bugs.xdavidhu.me</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <p class="post-meta"> <span>#0006</span><br/> <span>Vendor: Apple</span><br/> <span>Status: fixed</span><br/> <span>Reported: Sep 20, 2020</span><br/> <span>Disclosed: </span><time datetime="2021-05-18T00:00:00+00:00" itemprop="datePublished">May 18, 2021</time> (240 days) </p> <h1 class="post-title" itemprop="name headline">Path Traversal in MobileSafari</h1> </header> <div class="post-content" itemprop="articleBody"> <p><strong>Summary:</strong></p> <p>I have found a path traversal issue in Safari, present in iOS 14.0. When saving a web page as PDF into Files, Safari uses the page’s <code class="language-plaintext highlighter-rouge">&lt;title&gt;</code> tag as a file name, without sanitising it first, leading to path traversal.</p> <p><strong>Steps to reproduce:</strong></p> <ol> <li>Set up a webserver hosting this HTML file:</li> </ol> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;title&gt;/../../Library/Preferences/&lt;/title&gt;
&lt;h1&gt;Hello world!&lt;/h1&gt;
</code></pre></div></div> <ol start="2"> <li>Open the page in Safari</li> <li>Tap <code class="language-plaintext highlighter-rouge">Share</code></li> <li>Tap <code class="language-plaintext highlighter-rouge">Options</code> -&gt; Set <code class="language-plaintext highlighter-rouge">Send As</code> to <code class="language-plaintext highlighter-rouge">PDF</code> -&gt; Tap the back arrow</li> <li>Tap <code class="language-plaintext highlighter-rouge">Save to Files</code></li> <li>An extension-less file named <code class="language-plaintext highlighter-rouge">pdf</code> was created at <code class="language-plaintext highlighter-rouge">/private/var/mobile/Containers/Data/Application/[safari's UUID]/Library/Preferences/pdf</code></li> </ol> <p>This file was created by the <code class="language-plaintext highlighter-rouge">MobileSafari</code> process.</p> <p><strong>Extras / limitations:</strong></p> <ul> <li>If the <code class="language-plaintext highlighter-rouge">&lt;title&gt;</code> tag ends with a <code class="language-plaintext highlighter-rouge">/</code>, a file named <code class="language-plaintext highlighter-rouge">pdf</code> will be created.</li> <li>If the <code class="language-plaintext highlighter-rouge">&lt;title&gt;</code> tag doesn’t end with a <code class="language-plaintext highlighter-rouge">/</code>, <code class="language-plaintext highlighter-rouge">.pdf</code> is always appended at the end of the file.</li> <li>If the file to create already exists, a <code class="language-plaintext highlighter-rouge">-1</code> or <code class="language-plaintext highlighter-rouge">-2</code> (incremental number) will be added to the filename, before the first dot. (example: if <code class="language-plaintext highlighter-rouge">/Library/Preferences/com.apple.mobilesafari.plist.pdf</code> already exists, pressing <code class="language-plaintext highlighter-rouge">Save to Files</code> will create <code class="language-plaintext highlighter-rouge">/Library/Preferences/com-1.apple.mobilesafari.plist.pdf</code>)</li> <li>If a file path outside the app folder is provided, a warning in the Console from the <code class="language-plaintext highlighter-rouge">kernel</code> process will show. e.g.: <code class="language-plaintext highlighter-rouge">Sandbox: MobileSafari(1756) deny(1) file-write-create /private/var/pdf</code>.</li> </ul> <p>A malicious attack could may use this vulnerability to permanently crash Safari by creating a file which Safari is unable to parse.</p> <p>As far as I know Safari can’t be deleted/reinstalled, so I’m not sure how to remove these test/malicious files from Safari’s filesystem.</p> <p>Thank you, <br /> David</p> <p><em>This issue was fixed in <a href="https://support.apple.com/en-us/HT212317">iOS/iPadOS 14.5</a> and in <a href="https://support.apple.com/en-us/HT212324">watchOS 7.4</a>.</em></p> </div> </article> </main> </body> </html>
