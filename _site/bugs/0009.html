<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <base target="_blank"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> [#0009] IDOR in Google Identity platform allows leaking limited OAuth client data | feed </title> <meta name="description" content=" xdavidhu&#39;s bug bounty disclosures. "> <meta name="keywords" content=""> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="xdavidhu"> <meta name="twitter:title" content="IDOR in Google Identity platform allows leaking limited OAuth client data"> <meta name="twitter:description" content="xdavidhu's bug bounty disclosures."> <meta name="twitter:image:src" content="http://192.168.56.106:9885/asd/assets/img/cover.png"> <!-- Social: Open Graph --> <meta name="title" property="og:title" content="IDOR in Google Identity platform allows leaking limited OAuth client data"> <meta name="description" property="og:description" content="xdavidhu's bug bounty disclosures."> <meta name="image" property="og:image" content="http://192.168.56.106:9885/asd/assets/img/cover.png"> <meta name="author" content="David SchÃ¼tz"> <!-- Canonical link tag --> <link rel="canonical" href="http://192.168.56.106:9885/asd/bugs/0009"> <link rel="alternate" type="application/rss+xml" title="feed" href="http://192.168.56.106:9885/asd/feed.xml"> <!-- rel prev and next --> <link rel="stylesheet" href="http://192.168.56.106:9885/asd/assets/css/main.css"> </head> <body> <main class="wrapper"> <header class="site-header"> <nav> <div class="container nav-container"> <h1 class="logo"><a href="http://192.168.56.106:9885/asd/" target="_self">feed<span></span></a></h1> <ul class="navbar"> <li><a href="https://bugs.xdavidhu.me/" target="_self">bugs.xdavidhu.me</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <p class="post-meta"> <span>#0009</span><br/> <span>Vendor: Google</span><br/> <span>Status: <span style='color: red;'>wont-fix</span></span><br/> <span>Reported: Apr 09, 2021</span><br/> <span>Disclosed: </span><time datetime="2021-07-08T00:00:00+00:00" itemprop="datePublished">Jul 08, 2021</time> (90 days) </p> <h1 class="post-title" itemprop="name headline">IDOR in Google Identity platform allows leaking limited OAuth client data</h1> </header> <div class="post-content" itemprop="articleBody"> <p><strong>Summary:</strong></p> <p>Using the <code class="language-plaintext highlighter-rouge">/v1/brands/lookupkey/brand/[brand_id]</code> endpoint on the <code class="language-plaintext highlighter-rouge">clientauthconfig.googleapis.com</code> API, its possible to request information about any brand, without any authentication.</p> <p>Since the <code class="language-plaintext highlighter-rouge">brand_id</code> is normally the same as the <code class="language-plaintext highlighter-rouge">project_number</code>, only the <code class="language-plaintext highlighter-rouge">project_number</code> is needed to exploit this vulnerability. The <code class="language-plaintext highlighter-rouge">project_number</code> can leak from an API key when sending a request with the key to an API thatâ€™s not enabled on the keyâ€™s project.</p> <p>The endpoint even returns <code class="language-plaintext highlighter-rouge">brand</code>s that are Google Workspace internal. (<code class="language-plaintext highlighter-rouge">"isOrgInternal": true</code>)</p> <p>Normally, even if you have the <code class="language-plaintext highlighter-rouge">client_id</code>, trying to start an OAuth flow on a Workspace internal <code class="language-plaintext highlighter-rouge">brand</code> as an outsider only returns a <code class="language-plaintext highlighter-rouge">Error 403: org_internal This client is restricted to users within its organization.</code> error, and doesnâ€™t leak any information about the <code class="language-plaintext highlighter-rouge">brand</code>â€™s name, or other details. So those details are clearly considered private, but this endpoint leaks them.</p> <p><strong>Core Issue:</strong></p> <p>There is no access control on the <code class="language-plaintext highlighter-rouge">/v1/brands/lookupkey/brand/[brand_id]</code> endpoint. <br /> It should require <code class="language-plaintext highlighter-rouge">read</code> permissions on the <code class="language-plaintext highlighter-rouge">brand</code>â€™s project. This is even stated in the APIâ€™s Discovery Document:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Retrieve branding info given a brand_id.
Requires read permission on the associated project.
</code></pre></div></div> <p><strong>Steps to reproduce:</strong></p> <ol> <li>Create a GCP project, and note the projectâ€™s <code class="language-plaintext highlighter-rouge">project_number</code></li> <li>Go to <code class="language-plaintext highlighter-rouge">https://console.cloud.google.com/apis/credentials/consent</code> and set up a consent screen (<code class="language-plaintext highlighter-rouge">brand</code>)</li> <li>Send this unauthenticated <code class="language-plaintext highlighter-rouge">GET</code> request (the API key is from Cloud Console):</li> </ol> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /v1/brands/lookupkey/brand/[project_number]?readMask=*&amp;%24outputDefaults=true HTTP/1.1
Host: clientauthconfig.googleapis.com
Origin: https://console.cloud.google.com
X-Goog-Api-Key: AIzaSyCI-zsRP85UVOi0DjtiCwWBwQ1djDy741g


</code></pre></div></div> <ol start="4"> <li>See the <code class="language-plaintext highlighter-rouge">brand</code> object returned in the response</li> </ol> <p><strong>Attack scenario:</strong></p> <p>Any unauthenticated attacker who knows the target projectâ€™s <code class="language-plaintext highlighter-rouge">project_number</code>. As I stated above, the project_number can leak from a publicly exposed API key when sending a request with the key to an API thatâ€™s not enabled on the keyâ€™s project.</p> <hr /> <h3 id="comments">Comments:</h3> <p><strong>Vendor - 2021-04-09 19:06</strong></p> <p><em>NOTE: This e-mail has been generated automatically.</em></p> <p>Thanks for your report.</p> <p>This email confirms weâ€™ve received your message. Weâ€™ll investigate and get back to you once weâ€™ve got an update. In the meantime, you might want to take a look at the <a href="https://sites.google.com/site/bughunteruniversity/behind-the-scenes/faq">list of frequently asked questions about Google VRP</a>.</p> <p>If you are reporting a security vulnerability and wish to appear in Google Security Hall of Fame, please <a href="https://bughunter.withgoogle.com/new_profile">create a profile</a>.</p> <p>You appear automatically in our Honorable Mentions if we decide to file a security vulnerability based on your report, and you will also show up in our Hall of Fame if we issue a reward.</p> <p><strong>Note that if you did not report a vulnerability, or a technical security problem in one of our products, we wonâ€™t be able to act on your report. This channel is not the right one if you wish to resolve a problem with your account, report non-security bugs, or suggest a new feature in our product.</strong></p> <p>Cheers, <br /> Google Security Bot</p> <p><a href="https://twitter.com/googlevrp">Follow us</a> on Twitter!</p> <hr /> <p><strong>Vendor - 2021-04-12 09:16</strong></p> <p><em>NOTE: This e-mail has been generated automatically.</em></p> <p>Hey,</p> <p>Just letting you know that your report was <strong>triaged</strong> and weâ€™re currently looking into it.</p> <p>You should receive a response in a couple of days, but it might take up to a week if weâ€™re particularly busy. In the meantime, you might want to take a look at <a href="https://sites.google.com/site/bughunteruniversity/behind-the-scenes/faq">the list of frequently asked questions about Google VRP</a>.</p> <p>Thanks, <br /> Google Security Bot</p> <hr /> <p><strong>Vendor - 2021-04-13 16:53</strong></p> <p>Hi,</p> <p>ðŸŽ‰ <strong>Nice catch!</strong> Iâ€™ve filed a bug based on your report.</p> <p>The panel will evaluate it at the next VRP panel meeting and weâ€™ll update you once weâ€™ve got more information. All you need to do now is wait. If you donâ€™t hear back from us in 2-3 weeks or have additional information about the vulnerability, let us know!</p> <p>Regards, <br /> [redacted], Google Security Team</p> <hr /> <p><strong>Vendor - 2021-04-22 21:20</strong></p> <p>** NOTE: This is an automatically generated email **</p> <p>Hello,</p> <p>We have notified the team about this issue; they will review your report and decide whether they want to make a change or not. Thanks for letting us know.</p> <p>Regarding our Vulnerability Reward Program, the panel decided this issueâ€™s security impact does not meet the criteria to qualify for a reward in the program, so we wonâ€™t be issuing a reward at this time.</p> <p>Regards, Google Security Bot</p> <p>â€“ How did we do? Please fill out a short anonymous survey (https://goo.gl/IR3KRH).</p> <hr /> <p><strong>Vendor - 2021-06-10 23:44</strong></p> <p><em>NOTE: This is an automatically generated email</em></p> <p>Hello,</p> <p>Our systems show that the bug we created based on your report <strong>has been closed without providing a fix</strong>.</p> <p>This may have happened for various reasons: the risk impact might be too small to warrant a fix, there might be other mitigating factors, or simply the product is not maintained anymore.</p> <p>The exact status is <strong>INTENDED_BEHAVIOR</strong>. This decision has been made by the relevant product teams and does not affect your VRP reward amount or Hall of Fame position.</p> <p>We canâ€™t provide more details in this automated notification, but weâ€™ll be happy to answer your questions regarding this decision.</p> <p>Thanks, <br /> Google Security Bot</p> <hr /> <p><strong>Me - 2021-06-18 17:17</strong></p> <p>Hi,</p> <p>Just a heads up, this report will be disclosed in 20 days, on <code class="language-plaintext highlighter-rouge">2021-07-08</code>.</p> <p>Is this really intended behaviour? I think the documentation states somewhere that org internal clients are not visible to anyone outside the org. Trying to log in to an org internal client with OAuth also throws an error without providing any information (like name, email address), but this bug leaks those details.</p> <p>Thank you, <br /> David</p> <hr /> <p><strong>Vendor - 2021-06-21 22:14</strong></p> <p>Hi,</p> <p>The product team thinks that this information is public. The info is also available through other sources. If someone can construct the authorization URL using the client-id and redirect URI, they would be able to get part of this data on the consent screen (eg. app name, privacy policy, etc.).</p> <p>Why do you think that the info should be private? If you can find it, can you give a link to the documentation that mentions that internal clients arenâ€™t visible?</p> </div> </article> </main> </body> </html>
