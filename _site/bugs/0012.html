<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <base target="_blank"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> [#0012] Specific Google Assistant queries allow leaking Location History from a locked phone | feed </title> <meta name="description" content=" xdavidhu&#39;s bug bounty disclosures. "> <meta name="keywords" content=""> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="xdavidhu"> <meta name="twitter:title" content="Specific Google Assistant queries allow leaking Location History from a locked phone"> <meta name="twitter:description" content="xdavidhu's bug bounty disclosures."> <meta name="twitter:image:src" content="http://192.168.56.106:9885/asd/assets/img/cover.png"> <!-- Social: Open Graph --> <meta name="title" property="og:title" content="Specific Google Assistant queries allow leaking Location History from a locked phone"> <meta name="description" property="og:description" content="xdavidhu's bug bounty disclosures."> <meta name="image" property="og:image" content="http://192.168.56.106:9885/asd/assets/img/cover.png"> <meta name="author" content="David Sch√ºtz"> <!-- Canonical link tag --> <link rel="canonical" href="http://192.168.56.106:9885/asd/bugs/0012"> <link rel="alternate" type="application/rss+xml" title="feed" href="http://192.168.56.106:9885/asd/feed.xml"> <!-- rel prev and next --> <link rel="stylesheet" href="http://192.168.56.106:9885/asd/assets/css/main.css"> </head> <body> <main class="wrapper"> <header class="site-header"> <nav> <div class="container nav-container"> <h1 class="logo"><a href="http://192.168.56.106:9885/asd/" target="_self">feed<span></span></a></h1> <ul class="navbar"> <li><a href="https://bugs.xdavidhu.me/" target="_self">bugs.xdavidhu.me</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <p class="post-meta"> <span>#0012</span><br/> <span>Vendor: Google</span><br/> <span>Status: fixed</span><br/> <span>Reported: Sep 01, 2020</span><br/> <span>Disclosed: </span><time datetime="2022-02-06T00:00:00+00:00" itemprop="datePublished">Feb 06, 2022</time> (523 days) </p> <h1 class="post-title" itemprop="name headline">Specific Google Assistant queries allow leaking Location History from a locked phone</h1> </header> <div class="post-content" itemprop="articleBody"> <p>Summary: Location history can be extracted from locked phone via Assistant queries</p> <p><strong>Short summary:</strong></p> <p>Sensitive location history information can be extracted from a locked Android phone / Google Home (with personal results disabled) via specific Assistant queries.</p> <p><strong>Steps to reproduce:</strong></p> <ol> <li>Set up an Android phone with Assistant with an account that has places saved in location history</li> <li>Lock the device</li> <li>Trigger the Assistant on the lock screen</li> <li>Ask ‚ÄúWhat [PLACE_TYPE] have I visited?‚Äù (PLACE_TYPE can be for example: ‚Äúplaces‚Äù, ‚Äúrestaurants‚Äù, ‚Äúshops‚Äù)</li> <li>Assistant will respond with: ‚ÄúHere are the most recent ones:‚Äù and will list the places the vicim visited without unlocking the screen. It will also show e.g. ‚ÄúYou visited yesterday.‚Äù or ‚ÄúYou visited 3 weeks ago.‚Äù for places the victim visited recently.</li> </ol> <p>This info can leak from multiple places. Another example:</p> <ol> <li>Make sure the victim account have visited a nearby Burger King</li> <li>Trigger the Assistant on the lock screen and say ‚ÄúBurger King‚Äù</li> <li>If multiple results are available, it will show a list, and will include sensitive info such as ‚ÄúYou visited yesterday.‚Äù If there is only one result, or you select one by saying ‚Äúthe first one‚Äù, the ‚ÄúPlace Card‚Äù result will also expose ‚ÄúYou visited yesterday.‚Äù style sensitive information.</li> </ol> <p>These steps (more or less similarly) work the same way on a Google Home device which has Personal Results disabled. My non personal results Google Home Mini listed 3 recent places from my account‚Äôs Location History when asked ‚ÄúWhat places have I visited?‚Äù</p> <p>I suspect this is a server-side issue and these location history add-ons in Assistant do not set some kind of ‚Äúpersonal‚Äù flag, so both the locked Assistant on a phone, and the non personal results Google Home respond to it without requesting unlock/permission.</p> <p>Attack scenario: The location history of a user is extremely sensitive data. It or parts of it should never be accessible from a locked phone. If a user leaves his/her phone unattended a malicious attacker could issue a lot of queries and map out the location history of the user. Also, the same applies to Google Home with Personal Results disabled. <strong>Location History in any form is a personal result.</strong></p> <hr /> <h3 id="comments">Comments:</h3> <p><strong>Vendor</strong></p> <p><em>automated response acknowledging my report</em></p> <hr /> <p><strong>Vendor</strong></p> <p>Hey,</p> <p>Thanks for your efforts for keeping our users secure! We‚Äôve investigated your submission and made the decision not to track it as a security bug, as we‚Äôre already aware of this.</p> <p>Users on Android phones are able to configure unlocking their phone when speaking ‚ÄúOK Google‚Äù. This feature may be called Voice Match or Trusted Voice, depending on you Android version. Sometimes this setting gets enabled, when setting up the Google Assistant application.</p> <p>Please kindly check in your phone settings if this unlocking feature is enabled. This might me under different settings depending on your Android version, phone manufacturer or your locale settings - check your settings for ‚ÄúSmart Lock‚Äù, ‚ÄúVoice match‚Äù or ‚ÄúTrusted Voice‚Äù.</p> <p>For example, In Google Pixel in Android Oreo, this should be visible under ‚ÄúSettings &gt; Security and Location &gt; Trust Agents‚Äù. In Samsung phones, this might under in ‚ÄúSettings &gt; Lock Screen and Security &gt; Smart Lock &gt; Trusted Voice &gt; Unlock with Voice Match‚Äù. See also https://support.google.com/pixelphone/answer/6093922 and https://support.google.com/assistant/answer/7394306.</p> <p>To avoid having your phone unlock when speaking ‚ÄúOK Google‚Äù, or a closely matching phrase, please turn that feature off. We are aware that the voice recognition is not perfect, and that there might be various bypass methods by e.g. recording the phrase and then replaying it, or triggering certain actions in Google Assistant. You can stop all those vectors by disabling Voice Match/Trusted Voice in your settings.</p> <p>If we misunderstood your report, please let us know.</p> <p>== The fine print == Your report is now <em>closed</em>, but you can still respond, and we‚Äôll take a look at your response.</p> <p>If you just reported this in order to help us make Google safer, thank you very much for your help! And please file a new bug if you find a different issue in the future.</p> <p>If your report was about participating in the Google VRP,: Because we did not file a bug internally because of your report, it will not give you credit in the Google Bug Hunter Hall of Fame, and it is also not in scope for a reward for the VRP. We‚Äôve built some learning resources for bug hunters that want to participate in the Google VRP. Check them out at http://g.co/bughunteruniversity</p> <p>Thanks again for your help, and hope to hear back from you in the future.</p> <hr /> <p><strong>Me</strong></p> <p>Hi,</p> <p>I strongly suspect that you misunderstood this report and it is indeed a technical issue.</p> <p>The device used to reproduce this issue has ‚ÄúVoice Match‚Äù / other voice unlock options disabled. Also, the device has ‚ÄúLock screen personal results‚Äù disabled. Furthermore, the above mentioned Google Home Mini also has ‚ÄúPersonal Results‚Äù disabled.</p> <p>Any other personal query results in Assistant requesting me to unlock the device.</p> <p>The specific Location History queries mentioned above do not get blocked by an unlock request, and proceed on a locked phone, therefore leaking sensitive the victim‚Äôs location data.</p> <p>Thanks, David</p> <hr /> <p><strong>Vendor</strong></p> <p>That is not the behaviour I experienced; therefore, I‚Äôd like to request a video PoC evidencing settings that the security settings appear to function in a manner contrary to actual function. I recommend annotating your video subtitles or including a summary of important timestamps to ease following your narrative.</p> <p>[redacted]<br /> Google Trust &amp; Safety</p> <hr /> <p><strong>Me</strong></p> <p>Hi,</p> <p>I made a POC video to showcase the issue. It shows the issue on both the locked Android and the Google Home Mini.</p> <p>Video: <code class="language-plaintext highlighter-rouge">https://youtu.be/5ouB01TLE_g</code> (length: 1:27)</p> <p>Thanks, David</p> <hr /> <p><strong>Vendor</strong></p> <p>I see the process you followed. My teammate‚Äôs comment I uphold: ‚Äútechnical‚Äù I construe as ‚Äúrequiring technical expertise within security, and often knowledge within auditing or privacy to lead to the discovery of the process.‚Äù This may be deep expertise of network packets, WAP, so forth.</p> <p>Furthermore, was this really something that is exclusive to Voice Match?</p> <p>[redacted]<br /> Google Trust &amp; Safety</p> <hr /> <p><strong>Me</strong></p> <p>Hi,</p> <p>I feel like you misunderstood my previous comment. By ‚Äútechnical‚Äù in comment #4, I was referring to the issue not being a misconfiguration on my device, but an actual issue in Assistant.</p> <p>To address the second question, as far as I know there is no available public documentation showing what Assistant queries are considered ‚ÄúPersonal‚Äù.</p> <p>Therefore I can only assume, that if ‚ÄúWhat is my name?‚Äù is considered a ‚ÄúPersonal‚Äù result requiring screen-unlock, accessing the underlying Google account‚Äôs location history would also be considered ‚ÄúPersonal‚Äù, since location history data is arguably way more privacy sensitive information than a name.</p> <p>Again, as I stated in my initial report, my personal opinion is that: <strong>Location History in any form is a personal result.</strong></p> <p>Thank you, David</p> <hr /> <p><strong>Vendor</strong></p> <p>Hi,</p> <p>üéâ <strong>Nice catch!</strong> I‚Äôve filed a bug based on your report.</p> <p>The panel will evaluate it at the next VRP panel meeting and we‚Äôll update you once we‚Äôve got more information. All you need to do now is wait. If you don‚Äôt hear back from us in 2-3 weeks or have additional information about the vulnerability, let us know!</p> <p>Regards, <br /> [redacted], Google Trust &amp; Safety Team</p> <hr /> <p><strong>Vendor</strong></p> <p><em>automated response of a $1337.00 reward</em></p> <hr /> <p><strong>Vendor</strong></p> <p>Hi David,</p> <p>Per our email discussion, sending you a note just as an FYI: We classified this report as an abuse risk.</p> <p>Best of luck in your future research, [redacted]</p> <hr /> <p><strong>Me</strong></p> <p>Hi,</p> <p>I have noticed that a fix has been pushed for this bug, and it indeed seems to fix the issue in <code class="language-plaintext highlighter-rouge">com.google.android.googlequicksearchbox</code>.</p> <p>But it looks like that Google Home devices are still vulnerable. Today I asked my Nest Audio (with personal results disabled) <code class="language-plaintext highlighter-rouge">what restaurants have I visited?</code>, and it answered me, just like in the POC video.</p> <p>This might be from the fact that some actions behave differently on phone, and on the Google Home, for example saying <code class="language-plaintext highlighter-rouge">turn on the lights</code> requires an unlock on the phone, but works without personal results on the Google Home.</p> <p>I still think that location history <strong>should never be leaked without enabling personal results</strong>, not even on a Google Home device which is considered to be in a somewhat trusted physical environment.</p> <p>Thanks, <br /> David</p> <hr /> <p><strong>Vendor</strong></p> <p>Hi David,</p> <p>Thanks for flagging this! We‚Äôve notified the team and we will get back to you once we hear from them.</p> <p>Happy New Year!</p> <p>[redacted]</p> <hr /> <p><strong>Vendor</strong></p> <p>Hey David,</p> <p>Just one quick follow-up question, do you have voice recognition on your nest device? If yes, have you tried this with someone else voice as well?</p> <p>Thanks in advance, [redacted]</p> <hr /> <p><strong>Vendor</strong></p> <p>Hi David,</p> <p>If you could also share the gmail address you used in the attack it would help the team to debug this issue.</p> <p>Thanks in advance, [redacted]</p> <hr /> <p><strong>Me</strong></p> <p>Hi,</p> <p>I used this email address, <code class="language-plaintext highlighter-rouge">dadkalevelei@gmail.com</code>.<br /> I do not have any kind of voice recognition/voice match set up. Also of course <code class="language-plaintext highlighter-rouge">Personal Results</code> are disabled.</p> <p>Thanks,<br /> David</p> <hr /> <p><strong>Vendor</strong></p> <p>Great - thanks for a fast response David!</p> <hr /> <p><strong>Vendor</strong></p> <p><em>automated response of a $1337.00 reward</em></p> <hr /> <p><strong>Me</strong></p> <p>Oh, thank you for that, that was unexpected! :) <br /> I assume it is for bypassing the fix.</p> <p>Thank you, <br /> David</p> <hr /> <p><strong>Me</strong></p> <p>By the way, if it‚Äôs possible to ask, since it was my personal device/account‚Äôs email that I gave to the team, it made me think about how it could have helped in the debugging process.</p> <p>Is it only used to get basic info about my devices, or can developers just get full access to query history based on an email address? I hope thats not possible.</p> <p>Thank you, <br /> David</p> <hr /> <p><strong>Vendor</strong></p> <p>Hi David,</p> <p>In short: When you use our services, you‚Äôre trusting us with your information. We understand this is a big responsibility and work hard to protect your information and put you in control.</p> <p>For more details about why and how we collect user data and the privacy controls that users can use you can read <a href="https://policies.google.com/privacy?hl=en-US#whycollect">this article</a> which provides a detailed overview.</p> <p>Best,</p> <p>[redacted]</p> <hr /> <p><strong>Me</strong></p> <p>Hi,</p> <p>After routinely asking my Nest ‚Äúwhat restaurants have I visited?‚Äù every other day, on Friday I noticed that it now gives me the standard ‚ÄúFor help with that, first you‚Äôll need to allow personal‚Ä¶‚Äù. So it looks like this issue is fixed now on both the mobile app and in the Home devices. Actually, now I can‚Äôt even trigger Assistant on the lock screen. Not sure why that is.</p> <p>Can you please confirm that these fixes has been fully rolled out? Or that they will be until <code class="language-plaintext highlighter-rouge">2021-02-01</code>?</p> <p><strong>[Disclosure Warning]</strong></p> <p>Since all of the issues seem to be mitigated, I wanted to give a heads-up that I will be disclosing this bug publicly on my website https://bugs.xdavidhu.me/, <strong>7 days from now</strong>, on <code class="language-plaintext highlighter-rouge">2021-02-01</code>.</p> <p>If you would like to delay/cancel the disclosure, please reply to this comment <strong>before <code class="language-plaintext highlighter-rouge">2021-01-11</code></strong>.</p> <p>Thank you, <br /> David</p> <hr /> <p><strong>Me</strong></p> <p>Whoops, that was a typo. I meant ‚Äúplease reply to this comment <strong>before <code class="language-plaintext highlighter-rouge">2021-02-01</code></strong>.‚Äù</p> <p>I‚Äôm not that good with templates yet ;)</p> <hr /> <p><strong>Vendor</strong></p> <p>Thanks for the heads-up David!</p> <p>Let me reach to the product team for the confirmation and get back to you!</p> <p>Best, [redacted]</p> <hr /> <p><strong>Vendor</strong></p> <p>Hi David,</p> <p>The issue is fixed and rolled out already. If you would like to share with us the draft of the blog in advance, that would be great! We can always share it with the teams for a review.</p> <p>Best, [redacted]</p> <hr /> <p><strong>Me &amp; Vendor</strong></p> <p><em>chatting about the disclosure timeline</em></p> <hr /> <p><strong>Me</strong></p> <p>Hi,</p> <p>So I have been thinking about adding a section to the blog post about how to configure your phone and disable all personal results on the lock screen, but I realised even I don‚Äôt fully understand how this works, so I spent like an hour trying to figure it out, and now I think I get it. But, the settings are very confusing and misleading, and I don‚Äôt think an average user would understand them, even though this is a very important privacy setting.</p> <p>So I could write my findings down about how to securely configure the Assistant in my blog, but it‚Äôs so weird that it might even be a bug on its own.</p> <p>Here are my concerns:</p> <ul> <li>The ‚Äúpersonal results‚Äù settings are now moved to a different location (<code class="language-plaintext highlighter-rouge">Google App</code> -&gt; <code class="language-plaintext highlighter-rouge">More</code> -&gt; <code class="language-plaintext highlighter-rouge">Settings</code> -&gt; <code class="language-plaintext highlighter-rouge">Google Assistant</code> -&gt; <code class="language-plaintext highlighter-rouge">Personalization</code>), where it should give you a central control page over all of the ‚Äúpersonal results‚Äù settings. This would be great, but it does not contain all ‚Äúpersonal results‚Äù settings, therefore it might confuse users and give a false sense of security.</li> <li>If on this page you disable everything lock screen related (<code class="language-plaintext highlighter-rouge">Lock screen personal results</code>, <code class="language-plaintext highlighter-rouge">Personal suggestions on lock screen before you ask</code>, <code class="language-plaintext highlighter-rouge">On headphones</code>) you would think that now, there is no way to get personal results on the lock screen. <strong>This is not true.</strong></li> <li><strong>‚ÄúNormal‚Äù bluetooth headphones can still issue personal queries.</strong> To turn that off, you would have to go to <code class="language-plaintext highlighter-rouge">Google App</code> -&gt; <code class="language-plaintext highlighter-rouge">More</code> -&gt; <code class="language-plaintext highlighter-rouge">Settings</code> -&gt; <code class="language-plaintext highlighter-rouge">Voice</code> and disable <code class="language-plaintext highlighter-rouge">Allow Bluetooth requests with device locked</code>. <strong>This is enabled by default!</strong></li> <li>So, on the <code class="language-plaintext highlighter-rouge">Personalization</code> page, turning off <code class="language-plaintext highlighter-rouge">On headphones</code> <strong>only affects wired headphones</strong>, and some special Bluetooth headphones, like the Pixel Buds. <strong>Other normal BT headphones/speakers are unaffected</strong> by this, they are controlled by the <code class="language-plaintext highlighter-rouge">Allow Bluetooth requests with device locked</code>, which is on a completely different page. <strong>This <code class="language-plaintext highlighter-rouge">On headphones</code> setting should control every type of headphone/BT device.</strong></li> <li>After looking at two different devices, and resetting the Google app on one, I can confirm that <code class="language-plaintext highlighter-rouge">Allow Bluetooth requests with device locked</code> is <strong>enabled by default</strong>. Why is that? It doesn‚Äôt feel right. For every other type of headphone (wired, Pixel Buds), you have to specially opt-in to allow personal results.</li> <li>Also, confusingly, on the <code class="language-plaintext highlighter-rouge">Voice</code> page, you still have the <code class="language-plaintext highlighter-rouge">Allow wired headset requests with device locked</code>, which is now basically useless and doesn‚Äôt do anything, and sometimes toggling it redirects you to the <code class="language-plaintext highlighter-rouge">Personalization</code> page, but sometimes it does not, allowing you to toggle the switch, which just adds to the confusion.</li> </ul> <p>So, all in all, ‚Äúlock screen personal results‚Äù is in my opinion very sensitive setting, which should be presented very clearly to the users, and currently I doubt that an average user could make sense of all of this mess, and configure their device securely.</p> <p>Currently, since its <strong>enabled by default</strong>, if you have physical access to someone‚Äôs phone &amp; an already paired BT headphone (which are usually stored together), <strong>you can just ask personal queries</strong> without knowing the unlock credentials on most of the Android devices out there. And I don‚Äôt think that is okay.</p> <p>Thank you, <br /> David</p> <hr /> <p><strong>Vendor</strong></p> <p>Hi David,</p> <p>Thanks for investigating this and sharing your concerns.</p> <p>Since this issue is slightly different from your original report, could you please file a separate bug about this? Would be great if you could share with me the report id here, so that I can find it quickly and reach out to the Assistant team fast.</p> <p>Thanks, [redacted]</p> <hr /> <p><strong>Me</strong></p> <p>Hi,</p> <p>I made a new report with the ID <a href="/bugs/0013" target="_self">b/178587104</a>.</p> <p>Thank you, <br /> David</p> <hr /> <p><strong>Vendor</strong></p> <p>Great - thanks a lot David!</p> <p>I‚Äôve filed a separate bug to track that.</p> <p>Best, [redacted]</p> <hr /> <p><strong>Me &amp; Vendor</strong></p> <p><em>chatting about me not being ready with the blog post &amp; my surprise of the reward on the the other bug</em></p> <hr /> <p><strong>Me</strong></p> <p>Hi,</p> <p>Sorry to bring this back up but I am still a bit worried about the privacy implications of comment #20. \</p> <ul> <li>Is it possible for the product team to just search for someone‚Äôs email address and list all past queries &amp; recordings (or other personal data) without previous consent?</li> <li>Is that (hopefully) limited to some high privilege individuals? If so, was my current case elevated to such level?</li> <li>Are these debug data accesses have to be approved by multiple individuals?</li> <li>What would have happened if I had maliciously sent in someone else‚Äôs email address? Would the team look at the past queries of the individual, without consent?</li> <li>Does disabling <code class="language-plaintext highlighter-rouge">Web &amp; App Activity</code> on the given Google account prevents developers from accessing this data in a similar situation?</li> </ul> <p>I hope asking about this doesn‚Äôt come off as offensive, I am just legitimately worried about stuff that I can‚Äôt see inside :D. And I hope there is proper protection against a malicious insider, or against a malicious reporter. But I also understand that this could be NDA territory which you can‚Äôt really share information about.</p> <p>Thank you, <br /> David</p> <hr /> <p><strong>Vendor</strong></p> <p>Hi David,</p> <p>Thanks for reaching out and sharing your concerns - no offense taken I know your intensions are good ;).</p> <p>I am sure you have already checked <a href="https://myaccount.google.com/yourdata/assistant">Google external documentation</a> explaining how you can manage your data in Google Assistant. It describes how you can manage the information stored about your activity but I don‚Äôt think it fully addresses all your concerns. So here is more context:</p> <p>Google Privacy team works with all products like Assistant to set up rules for data access. These rules are described in <a href="https://policies.google.com/privacy?hl=en-US">Google Privacy Policy</a> and it has most of the answers to your questions (it also covers logs data and its format/storage).</p> <p><a href="https://policies.google.com/privacy?hl=en-US">The same rules</a> apply to the debugging process, which is only possible during a very short period of time and only under very strict access controls. In cases when debugging requires accessing the data from individual users, there are some rules they have to follow before the tools let them read any data. The basic rules are in the privacy policy but depending on the sensitivity of the data, some teams have even stricter rules, like the ones you mentioned (requested/approved by users, law enforcement, etc).</p> <p>Finally, for the past queries and recordings - these are described in <a href="https://policies.google.com/technologies/retention?hl=en-US">data retention policy</a> but <a href="https://myactivity.google.com/myactivity">Google My Activity</a> is the tool that allows to remove that data before the described periods of time.</p> <p>Hope it helps,</p> <p>[redacted]</p> <hr /> <p><strong>Me</strong></p> <p>Hey,</p> <p>Just a heads-up: From my testing it looks like all of the issues are fixed. I will be disclosing this report with all additional comments (with names redacted), this week.</p> <p>Thank you, <br /> David</p> </div> </article> </main> </body> </html>
