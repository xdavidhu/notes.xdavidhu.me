<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <base target="_blank"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> [#0014] CloudKit Share Records leak the title of private iCloud files | feed </title> <meta name="description" content=" xdavidhu&#39;s bug bounty disclosures. "> <meta name="keywords" content=""> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="xdavidhu"> <meta name="twitter:title" content="CloudKit Share Records leak the title of private iCloud files"> <meta name="twitter:description" content="xdavidhu's bug bounty disclosures."> <meta name="twitter:image:src" content="http://192.168.56.106:9885/asd/assets/img/cover.png"> <!-- Social: Open Graph --> <meta name="title" property="og:title" content="CloudKit Share Records leak the title of private iCloud files"> <meta name="description" property="og:description" content="xdavidhu's bug bounty disclosures."> <meta name="image" property="og:image" content="http://192.168.56.106:9885/asd/assets/img/cover.png"> <meta name="author" content="David Schütz"> <!-- Canonical link tag --> <link rel="canonical" href="http://192.168.56.106:9885/asd/bugs/0014"> <link rel="alternate" type="application/rss+xml" title="feed" href="http://192.168.56.106:9885/asd/feed.xml"> <!-- rel prev and next --> <link rel="stylesheet" href="http://192.168.56.106:9885/asd/assets/css/main.css"> </head> <body> <main class="wrapper"> <header class="site-header"> <nav> <div class="container nav-container"> <h1 class="logo"><a href="http://192.168.56.106:9885/asd/" target="_self">feed<span></span></a></h1> <ul class="navbar"> <li><a href="https://bugs.xdavidhu.me/" target="_self">bugs.xdavidhu.me</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <p class="post-meta"> <span>#0014</span><br/> <span>Vendor: Apple</span><br/> <span>Status: fixed</span><br/> <span>Reported: Dec 06, 2021</span><br/> <span>Disclosed: </span><time datetime="2022-04-05T00:00:00+00:00" itemprop="datePublished">Apr 05, 2022</time> (120 days) </p> <h1 class="post-title" itemprop="name headline">CloudKit Share Records leak the title of private iCloud files</h1> </header> <div class="post-content" itemprop="articleBody"> <p><strong>Summary:</strong></p> <p>CloudKit Share Records of all iCloud documents/files leak the document’s/file’s title via the <code class="language-plaintext highlighter-rouge">records/resolve</code> API call, even when <code class="language-plaintext highlighter-rouge">Who can access</code> is set to <code class="language-plaintext highlighter-rouge">Only people you invite</code>. This issue affects iCloud documents/files of all type, including Pages, Number, Keynote, and files in iCloud Drive.</p> <p><strong>Core Issue:</strong></p> <p>When a document/file is shared with a specific email address and <code class="language-plaintext highlighter-rouge">Who can access</code> is set to <code class="language-plaintext highlighter-rouge">Only people you invite</code>, a CloudKit Share Record get’s created. The link generated by the frontend looks like this: <code class="language-plaintext highlighter-rouge">https://www.icloud.com/[product]/[ShortGUID]#[document-title]</code>. Storing the title in the hash implies that the title should be inaccessible to a yet-logged-in user, hence transported in the URL’s hash segment. But even as an unauthenticated user, querying the <code class="language-plaintext highlighter-rouge">records/resolve</code> CloudKit endpoint with the file’s ShortGUID, the title is returned in the <code class="language-plaintext highlighter-rouge">share</code> -&gt; <code class="language-plaintext highlighter-rouge">fields</code> -&gt; <code class="language-plaintext highlighter-rouge">cloudkit.title</code> field.</p> <p>Other privacy sensitive data is returned in the same unauthenticated response, such as the owner of the document. This behaviour could as well be debated. Other similar providers like Google Drive don’t expose the owner of a file if the requestor has no access to the document.</p> <p><strong>Impact:</strong></p> <p>If an iCloud file is shared with at least one entity &amp; the attacker knows the file’s ShortGUID, the attacker can query the file’s title without having any access to the document. Knowing a file’s ShortGUID is not a privileged position, and it should only provide access to the tile if the file’s <code class="language-plaintext highlighter-rouge">Who can access</code> is set to <code class="language-plaintext highlighter-rouge">Anyone with the link</code>.</p> <p><strong>Steps to reproduce:</strong></p> <ol> <li>Log in to iCloud and visit <code class="language-plaintext highlighter-rouge">https://www.icloud.com/pages/</code></li> <li>Create a new document, and set a custom title. Make some changes to the file to trigger a save.</li> <li>Share the file with a specific email address, and make sure <code class="language-plaintext highlighter-rouge">Share Options</code> -&gt; <code class="language-plaintext highlighter-rouge">Who can access</code> is set to <code class="language-plaintext highlighter-rouge">Only people you invite</code>.</li> <li>Extract the ShortGUID from the generated link.</li> <li>Replace <code class="language-plaintext highlighter-rouge">ShortGUID_From_Step_4</code> in the body of this HTTP request, and send it.</li> </ol> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /database/1/com.apple.cloudkit/production/public/records/resolve HTTP/1.1
Host: ckdatabasews.icloud.com
Content-Length: 56

{"shortGUIDs":[{"value":"[ShortGUID_From_Step_4]"}]}
</code></pre></div></div> <ol start="6"> <li>See that the file’s current title is returned in response to this unauthenticated request.</li> </ol> <p><strong>[Disclosure Warning]:</strong></p> <p>This issue is subject to a 90 day disclosure deadline. On 2022-03-06 this issue will be publicly disclosed. If you would like to redact additional information or if for some reason the issue can’t be fixed until the deadline, let me know.</p> <hr /> <h3 id="discussion">Discussion:</h3> <p><strong>Vendor - 2021-12-06</strong></p> <p>Hello,</p> <p>Thank you for sharing this report with us.</p> <p>You should have already received our automated response message. I have reviewed your report, and we are investigating.</p> <p>Because of the potentially sensitive nature of security issues, we ask that this information remain between you and Apple while we investigate it further.</p> <p>We don’t automatically provide status updates on issues as we work on them. We will reach out if we have any questions or need additional details. Please include the Follow-up: number when requesting updates. Including this Follow-up: number allows us to rapidly associate it with your original report.</p> <p>Thank you again for taking the time to share this report with us.</p> <p>Best regards, <br /> <em>[redacted]</em> <br /> Apple Product Security</p> <hr /> <p><strong>Vendor - 2021-12-11</strong></p> <p>Hello,</p> <p>In order to help us reproduce and investigate this issue, we will need some additional details. Do you have a proof-of-concept or other example file that reproduces the issue? If so, we would appreciate it if you could send that along to us.</p> <p>Best regards, <br /> <em>[redacted]</em> <br /> Apple Product Security</p> <hr /> <p><strong>Me - 2021-12-13</strong></p> <p>Hi,</p> <p>I have recorded a proof of concept video of the issue: <a href="https://youtu.be/hViPqrHzyIs">https://youtu.be/hViPqrHzyIs</a></p> <p>As you can see, the final manually sent unauthenticated HTTP request with the ShortGUID exposes the title of the document, even though the document’s <code class="language-plaintext highlighter-rouge">Who can access</code> setting is set to <code class="language-plaintext highlighter-rouge">Only people you invite</code>.</p> <p>Thank you, <br /> David</p> <hr /> <p><strong>Vendor - 2021-12-13</strong></p> <p>Hello David,</p> <p>Thank you for the additional information. The information you’ve provided will be helpful in our efforts to determine the cause of the issue you reported.</p> <p>We appreciate your assistance in improving the security of our products.</p> <p>Best regards, <br /> <em>[redacted]</em> <br /> Apple Product Security</p> <hr /> <p><strong>Vendor - 2022-01-21</strong></p> <p>Hello David,</p> <p>Please treat the following information as confidential.</p> <p>The issue you reported will be partially addressed in a spring 2022 security update. We are still investigating ways to fully address the remaining issues. This is tentatively planned for fall 2022. We ask you to refrain from publishing the details of your report until it is addressed in all platforms and the CVE is published on our security advisory.</p> <p>Best regards, <br /> <em>[redacted]</em> <br /> Apple Product Security</p> <hr /> <p><strong>Vendor - 2022-02-09</strong></p> <p>Hello David,</p> <p>Please treat the following information as confidential.</p> <p>After further review it was found that more changes were needed to address the issues. This report now will be fully addressed in a fall 2022 security update. We ask you to refrain from publishing the details of your report until it is addressed in all platforms and the CVE is published on our security advisory.</p> <p>Best regards, <br /> <em>[redacted]</em> <br /> Apple Product Security</p> <hr /> <p><strong>Vendor - 2022-02-28</strong></p> <p>Hello David,</p> <p>Please treat the following information as confidential.</p> <p>We would like to provide you with a status update for this report.</p> <p>We anticipate this issue to be fully addressed in the next few weeks. To ensure adequate testing of the changes we have made, we are requesting a 30 day extension to your disclosure plans. The updated disclosure date for this report would instead be March 28, 2022.</p> <p>Are you willing to withhold disclosure of this report until it has been addressed on all platforms and the CVE is published on our security advisory?</p> <p>Best regards, <br /> <em>[redacted]</em> <br /> Apple Product Security</p> <hr /> <p><strong>Me - 2022-02-28</strong></p> <p>Hello <em>[redacted]</em>,</p> <p>Thank you for reaching out, I appreciate it. Yes, I am OK with extending the disclosure date by 30 days.</p> <p>The new disclosure date is Tuesday, 5 April 2022, or once the fix &amp; CVE has been published. Whichever comes first.</p> <p>Thanks, <br /> David</p> <hr /> <p><strong>Vendor - 2022-03-01</strong></p> <p>Hello David,</p> <p>Thank you for confirming the new disclosure date. We appreciate your patience while we address this issue.</p> <p>Best regards, <br /> <em>[redacted]</em> <br /> Apple Product Security</p> <hr /> <p><strong>Me - 2022-03-26</strong></p> <p>Hello,</p> <p>I just tested the issue and it looks fixed, seemingly even for previously generated share items.</p> <p>I have a few final questions regarding this bug:</p> <ul> <li>Has a CVE been issued for this bug?</li> <li>Does this bug qualify for Apple Security Bounty?</li> </ul> <p>Thank you, <br /> David</p> <hr /> <p><strong>Vendor - 2022-03-28</strong></p> <p>Hello David,</p> <p>Thank you for confirming you are no longer able to reproduce this issue.</p> <p>A CVE will be assigned to this issue shortly - we will follow up with those details soon.</p> <p>Regarding ASB, this issue is currently undergoing evaluation for an Apple Security Bounty. If applicable, we will reach out to you regarding the next steps.</p> <p>Thank you again for sending us this report. We look forward to any you may send our way in the future.</p> <p>Best regards, <br /> <em>[redacted]</em> <br /> Apple Product Security</p> </div> </article> </main> </body> </html>
